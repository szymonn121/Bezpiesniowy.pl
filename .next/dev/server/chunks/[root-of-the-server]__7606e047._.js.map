{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined;\r\n};\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"error\", \"warn\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  globalForPrisma.prisma = prisma;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B","debugId":null}},
    {"offset": {"line": 97, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/src/lib/auth.ts"],"sourcesContent":["import bcrypt from \"bcryptjs\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { UserRole } from \"@prisma/client\";\r\nimport type { NextRequest } from \"next/server\";\r\n\r\nconst TOKEN_COOKIE = \"bezpiesniowy_token\";\r\n\r\nexport interface AuthTokenPayload {\r\n  userId: number;\r\n  email: string;\r\n  role: UserRole;\r\n}\r\n\r\nfunction getJwtSecret(): string {\r\n  const secret = process.env.JWT_SECRET;\r\n  if (!secret) {\r\n    throw new Error(\"JWT_SECRET must be set\");\r\n  }\r\n  return secret;\r\n}\r\n\r\nexport async function hashPassword(plain: string): Promise<string> {\r\n  return bcrypt.hash(plain, 10);\r\n}\r\n\r\nexport async function verifyPassword(plain: string, hash: string): Promise<boolean> {\r\n  return bcrypt.compare(plain, hash);\r\n}\r\n\r\nexport function signAuthToken(payload: AuthTokenPayload, expiresIn = \"7d\"): string {\r\n  return jwt.sign(payload, getJwtSecret(), { expiresIn });\r\n}\r\n\r\nexport function verifyAuthToken(token: string): AuthTokenPayload | null {\r\n  try {\r\n    return jwt.verify(token, getJwtSecret()) as AuthTokenPayload;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function extractTokenFromHeader(header?: string | null): string | null {\r\n  if (!header) {\r\n    return null;\r\n  }\r\n  const [type, token] = header.split(\" \");\r\n  if (type?.toLowerCase() !== \"bearer\" || !token) {\r\n    return null;\r\n  }\r\n  return token;\r\n}\r\n\r\nexport function getTokenFromCookies(request: NextRequest): string | null {\r\n  return request.cookies.get(TOKEN_COOKIE)?.value ?? null;\r\n}\r\n\r\nexport { TOKEN_COOKIE };\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;;;AAIA,MAAM,eAAe;AAQrB,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;IACrC,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;AAEO,eAAe,aAAa,KAAa;IAC9C,OAAO,8IAAM,CAAC,IAAI,CAAC,OAAO;AAC5B;AAEO,eAAe,eAAe,KAAa,EAAE,IAAY;IAC9D,OAAO,8IAAM,CAAC,OAAO,CAAC,OAAO;AAC/B;AAEO,SAAS,cAAc,OAAyB,EAAE,YAAY,IAAI;IACvE,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,gBAAgB;QAAE;IAAU;AACvD;AAEO,SAAS,gBAAgB,KAAa;IAC3C,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,uBAAuB,MAAsB;IAC3D,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IACA,MAAM,CAAC,MAAM,MAAM,GAAG,OAAO,KAAK,CAAC;IACnC,IAAI,MAAM,kBAAkB,YAAY,CAAC,OAAO;QAC9C,OAAO;IACT;IACA,OAAO;AACT;AAEO,SAAS,oBAAoB,OAAoB;IACtD,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe,SAAS;AACrD","debugId":null}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/src/lib/server-auth.ts"],"sourcesContent":["import type { NextRequest } from \"next/server\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { TOKEN_COOKIE, extractTokenFromHeader, getTokenFromCookies, verifyAuthToken } from \"@/lib/auth\";\r\n\r\nexport async function getUserFromRequest(request: NextRequest) {\r\n  const headerToken = extractTokenFromHeader(request.headers.get(\"authorization\"));\r\n  const cookieToken = getTokenFromCookies(request);\r\n  const token = headerToken ?? cookieToken;\r\n\r\n  if (!token) return null;\r\n  const payload = verifyAuthToken(token);\r\n  if (!payload) return null;\r\n\r\n  return prisma.user.findUnique({\r\n    where: { id: payload.userId },\r\n  });\r\n}\r\n\r\nexport async function requireAdmin(request: NextRequest) {\r\n  const user = await getUserFromRequest(request);\r\n  if (!user || user.role !== \"ADMIN\") {\r\n    return null;\r\n  }\r\n  return user;\r\n}\r\n\r\n// ðŸ§© uniwersalna wersja getCurrentUserFromCookies\r\nexport async function getCurrentUserFromCookies(req?: any) {\r\n  let token: string | undefined;\r\n\r\n  try {\r\n    // PrÃ³ba uÅ¼ycia App Router API\r\n    const { cookies } = await import(\"next/headers\");\r\n    // `cookies()` is async in this Next.js runtime and must be awaited\r\n    const cookieStore = await cookies();\r\n    token = cookieStore.get(TOKEN_COOKIE)?.value;\r\n  } catch {\r\n    // Fallback dla Pages Router (req.cookies)\r\n    token = req?.cookies?.[TOKEN_COOKIE];\r\n  }\r\n\r\n  if (!token) return null;\r\n\r\n  const payload = verifyAuthToken(token);\r\n  if (!payload) return null;\r\n\r\n  return prisma.user.findUnique({\r\n    where: { id: payload.userId },\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAEA;AACA;;;AAEO,eAAe,mBAAmB,OAAoB;IAC3D,MAAM,cAAc,IAAA,8IAAsB,EAAC,QAAQ,OAAO,CAAC,GAAG,CAAC;IAC/D,MAAM,cAAc,IAAA,2IAAmB,EAAC;IACxC,MAAM,QAAQ,eAAe;IAE7B,IAAI,CAAC,OAAO,OAAO;IACnB,MAAM,UAAU,IAAA,uIAAe,EAAC;IAChC,IAAI,CAAC,SAAS,OAAO;IAErB,OAAO,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QAC5B,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;IAC9B;AACF;AAEO,eAAe,aAAa,OAAoB;IACrD,MAAM,OAAO,MAAM,mBAAmB;IACtC,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,SAAS;QAClC,OAAO;IACT;IACA,OAAO;AACT;AAGO,eAAe,0BAA0B,GAAS;IACvD,IAAI;IAEJ,IAAI;QACF,8BAA8B;QAC9B,MAAM,EAAE,OAAO,EAAE,GAAG;QACpB,mEAAmE;QACnE,MAAM,cAAc,MAAM;QAC1B,QAAQ,YAAY,GAAG,CAAC,oIAAY,GAAG;IACzC,EAAE,OAAM;QACN,0CAA0C;QAC1C,QAAQ,KAAK,SAAS,CAAC,oIAAY,CAAC;IACtC;IAEA,IAAI,CAAC,OAAO,OAAO;IAEnB,MAAM,UAAU,IAAA,uIAAe,EAAC;IAChC,IAAI,CAAC,SAAS,OAAO;IAErB,OAAO,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QAC5B,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;IAC9B;AACF","debugId":null}},
    {"offset": {"line": 218, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/src/app/api/songs/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { requireAdmin } from \"@/lib/server-auth\";\r\n\r\nexport async function GET(request: NextRequest) {\r\n  const admin = await requireAdmin(request);\r\n  if (!admin) {\r\n    return NextResponse.json({ message: \"Brak dostÄ™pu\" }, { status: 401 });\r\n  }\r\n\r\n  const songs = await prisma.song.findMany({\r\n    orderBy: { createdAt: \"desc\" },\r\n  });\r\n\r\n  return NextResponse.json({\r\n    songs: songs.map((song) => ({\r\n      id: song.id,\r\n      title: song.title,\r\n      artist: song.artist,\r\n      album: song.album,\r\n      year: song.year,\r\n      genre: song.genre,\r\n      fileName: song.fileName,\r\n      durationSeconds: song.durationSeconds,\r\n    })),\r\n  });\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,MAAM,QAAQ,MAAM,IAAA,8IAAY,EAAC;IACjC,IAAI,CAAC,OAAO;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAe,GAAG;YAAE,QAAQ;QAAI;IACtE;IAEA,MAAM,QAAQ,MAAM,gIAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;QACvC,SAAS;YAAE,WAAW;QAAO;IAC/B;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QACvB,OAAO,MAAM,GAAG,CAAC,CAAC,OAAS,CAAC;gBAC1B,IAAI,KAAK,EAAE;gBACX,OAAO,KAAK,KAAK;gBACjB,QAAQ,KAAK,MAAM;gBACnB,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,KAAK;gBACjB,UAAU,KAAK,QAAQ;gBACvB,iBAAiB,KAAK,eAAe;YACvC,CAAC;IACH;AACF","debugId":null}}]
}