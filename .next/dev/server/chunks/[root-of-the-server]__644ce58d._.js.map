{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined;\r\n};\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"error\", \"warn\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  globalForPrisma.prisma = prisma;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B","debugId":null}},
    {"offset": {"line": 97, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/src/lib/auth.ts"],"sourcesContent":["import bcrypt from \"bcryptjs\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { UserRole } from \"@prisma/client\";\r\nimport type { NextRequest } from \"next/server\";\r\n\r\nconst TOKEN_COOKIE = \"bezpiesniowy_token\";\r\n\r\nexport interface AuthTokenPayload {\r\n  userId: number;\r\n  email: string;\r\n  role: UserRole;\r\n}\r\n\r\nfunction getJwtSecret(): string {\r\n  const secret = process.env.JWT_SECRET;\r\n  if (!secret) {\r\n    throw new Error(\"JWT_SECRET must be set\");\r\n  }\r\n  return secret;\r\n}\r\n\r\nexport async function hashPassword(plain: string): Promise<string> {\r\n  return bcrypt.hash(plain, 10);\r\n}\r\n\r\nexport async function verifyPassword(plain: string, hash: string): Promise<boolean> {\r\n  return bcrypt.compare(plain, hash);\r\n}\r\n\r\nexport function signAuthToken(payload: AuthTokenPayload, expiresIn = \"7d\"): string {\r\n  return jwt.sign(payload, getJwtSecret(), { expiresIn });\r\n}\r\n\r\nexport function verifyAuthToken(token: string): AuthTokenPayload | null {\r\n  try {\r\n    return jwt.verify(token, getJwtSecret()) as AuthTokenPayload;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function extractTokenFromHeader(header?: string | null): string | null {\r\n  if (!header) {\r\n    return null;\r\n  }\r\n  const [type, token] = header.split(\" \");\r\n  if (type?.toLowerCase() !== \"bearer\" || !token) {\r\n    return null;\r\n  }\r\n  return token;\r\n}\r\n\r\nexport function getTokenFromCookies(request: NextRequest): string | null {\r\n  return request.cookies.get(TOKEN_COOKIE)?.value ?? null;\r\n}\r\n\r\nexport { TOKEN_COOKIE };\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;;;AAIA,MAAM,eAAe;AAQrB,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;IACrC,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;AAEO,eAAe,aAAa,KAAa;IAC9C,OAAO,8IAAM,CAAC,IAAI,CAAC,OAAO;AAC5B;AAEO,eAAe,eAAe,KAAa,EAAE,IAAY;IAC9D,OAAO,8IAAM,CAAC,OAAO,CAAC,OAAO;AAC/B;AAEO,SAAS,cAAc,OAAyB,EAAE,YAAY,IAAI;IACvE,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,gBAAgB;QAAE;IAAU;AACvD;AAEO,SAAS,gBAAgB,KAAa;IAC3C,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,uBAAuB,MAAsB;IAC3D,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IACA,MAAM,CAAC,MAAM,MAAM,GAAG,OAAO,KAAK,CAAC;IACnC,IAAI,MAAM,kBAAkB,YAAY,CAAC,OAAO;QAC9C,OAAO;IACT;IACA,OAAO;AACT;AAEO,SAAS,oBAAoB,OAAoB;IACtD,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe,SAAS;AACrD","debugId":null}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/src/app/api/auth/login/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { signAuthToken, verifyPassword, TOKEN_COOKIE } from \"@/lib/auth\";\r\n\r\nconst COOKIE_MAX_AGE = 60 * 60 * 24 * 7; // 7 dni\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const { email, password } = await request.json();\r\n\r\n    if (!email || !password) {\r\n      return NextResponse.json({ message: \"Email i hasło są wymagane\" }, { status: 400 });\r\n    }\r\n\r\n    const user = await prisma.user.findUnique({ where: { email } });\r\n    if (!user) {\r\n      return NextResponse.json({ message: \"Niepoprawne dane logowania\" }, { status: 401 });\r\n    }\r\n\r\n    const isValid = await verifyPassword(password, user.passwordHash);\r\n    if (!isValid) {\r\n      return NextResponse.json({ message: \"Niepoprawne dane logowania\" }, { status: 401 });\r\n    }\r\n\r\n    const token = signAuthToken({\r\n      userId: user.id,\r\n      email: user.email,\r\n      role: user.role,\r\n    });\r\n\r\n    const response = NextResponse.json({\r\n      message: \"Zalogowano pomyślnie\",\r\n      user: {\r\n        id: user.id,\r\n        email: user.email,\r\n        role: user.role,\r\n      },\r\n      token,\r\n    });\r\n\r\n    response.cookies.set({\r\n      name: TOKEN_COOKIE,\r\n      value: token,\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === \"production\",\r\n      sameSite: \"lax\",\r\n      maxAge: COOKIE_MAX_AGE,\r\n      path: \"/\",\r\n    });\r\n\r\n    return response;\r\n  } catch (error) {\r\n    console.error(\"Login error\", error);\r\n    return NextResponse.json({ message: \"Nie udało się zalogować\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,iBAAiB,KAAK,KAAK,KAAK,GAAG,QAAQ;AAE1C,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE9C,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE;YAAM;QAAE;QAC7D,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,MAAM,UAAU,MAAM,IAAA,sIAAc,EAAC,UAAU,KAAK,YAAY;QAChE,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,MAAM,QAAQ,IAAA,qIAAa,EAAC;YAC1B,QAAQ,KAAK,EAAE;YACf,OAAO,KAAK,KAAK;YACjB,MAAM,KAAK,IAAI;QACjB;QAEA,MAAM,WAAW,gJAAY,CAAC,IAAI,CAAC;YACjC,SAAS;YACT,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI;YACjB;YACA;QACF;QAEA,SAAS,OAAO,CAAC,GAAG,CAAC;YACnB,MAAM,oIAAY;YAClB,OAAO;YACP,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ;YACR,MAAM;QACR;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAA0B,GAAG;YAAE,QAAQ;QAAI;IACjF;AACF","debugId":null}}]
}