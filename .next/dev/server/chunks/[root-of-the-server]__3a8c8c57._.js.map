{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined;\r\n};\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"error\", \"warn\"] : [\"error\"],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  globalForPrisma.prisma = prisma;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B","debugId":null}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/src/lib/game.ts"],"sourcesContent":["export const SNIPPET_DURATIONS_SECONDS = [0.5, 1, 2, 5, 10] as const;\r\n\r\nexport const STAGE_SCORES = [10, 8, 6, 4, 2] as const;\r\n\r\nexport function scoreForStage(stageIndex: number, attempts: number): number {\r\n  const base = STAGE_SCORES[Math.min(stageIndex, STAGE_SCORES.length - 1)];\r\n  const penalty = Math.max(attempts - 1, 0);\r\n  return Math.max(base - penalty, 0);\r\n}\r\n\r\nexport function normalizeAnswer(answer: string): string {\r\n  return answer\r\n    .trim()\r\n    .toLowerCase()\r\n    .normalize(\"NFD\")\r\n    .replace(/≈Ç/g, \"l\")\r\n    .replace(/≈Å/g, \"l\")\r\n    .replace(/[\\u0300-\\u036f]/g, \"\")\r\n    .replace(/[^a-z0-9 ]/g, \"\")\r\n    .replace(/\\s+/g, \" \")\r\n    .trim();\r\n}\r\n\r\nexport function buildAcceptableAnswers(title: string, artist: string): string[] {\r\n  const normalizedTitle = normalizeAnswer(title);\r\n  const normalizedArtist = normalizeAnswer(artist);\r\n\r\n  const combos = [\r\n    normalizedTitle,\r\n    `${normalizedArtist} ${normalizedTitle}`.trim(),\r\n    `${normalizedTitle} ${normalizedArtist}`.trim(),\r\n    `${normalizedArtist}-${normalizedTitle}`.trim(),\r\n    `${normalizedTitle}-${normalizedArtist}`.trim(),\r\n  ];\r\n\r\n  return Array.from(new Set(combos.map(normalizeAnswer)));\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAO,MAAM,4BAA4B;IAAC;IAAK;IAAG;IAAG;IAAG;CAAG;AAEpD,MAAM,eAAe;IAAC;IAAI;IAAG;IAAG;IAAG;CAAE;AAErC,SAAS,cAAc,UAAkB,EAAE,QAAgB;IAChE,MAAM,OAAO,YAAY,CAAC,KAAK,GAAG,CAAC,YAAY,aAAa,MAAM,GAAG,GAAG;IACxE,MAAM,UAAU,KAAK,GAAG,CAAC,WAAW,GAAG;IACvC,OAAO,KAAK,GAAG,CAAC,OAAO,SAAS;AAClC;AAEO,SAAS,gBAAgB,MAAc;IAC5C,OAAO,OACJ,IAAI,GACJ,WAAW,GACX,SAAS,CAAC,OACV,OAAO,CAAC,MAAM,KACd,OAAO,CAAC,MAAM,KACd,OAAO,CAAC,oBAAoB,IAC5B,OAAO,CAAC,eAAe,IACvB,OAAO,CAAC,QAAQ,KAChB,IAAI;AACT;AAEO,SAAS,uBAAuB,KAAa,EAAE,MAAc;IAClE,MAAM,kBAAkB,gBAAgB;IACxC,MAAM,mBAAmB,gBAAgB;IAEzC,MAAM,SAAS;QACb;QACA,GAAG,iBAAiB,CAAC,EAAE,iBAAiB,CAAC,IAAI;QAC7C,GAAG,gBAAgB,CAAC,EAAE,kBAAkB,CAAC,IAAI;QAC7C,GAAG,iBAAiB,CAAC,EAAE,iBAAiB,CAAC,IAAI;QAC7C,GAAG,gBAAgB,CAAC,EAAE,kBAAkB,CAAC,IAAI;KAC9C;IAED,OAAO,MAAM,IAAI,CAAC,IAAI,IAAI,OAAO,GAAG,CAAC;AACvC","debugId":null}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/src/lib/auth.ts"],"sourcesContent":["import bcrypt from \"bcryptjs\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { UserRole } from \"@prisma/client\";\r\nimport type { NextRequest } from \"next/server\";\r\n\r\nconst TOKEN_COOKIE = \"bezpiesniowy_token\";\r\n\r\nexport interface AuthTokenPayload {\r\n  userId: number;\r\n  email: string;\r\n  role: UserRole;\r\n}\r\n\r\nfunction getJwtSecret(): string {\r\n  const secret = process.env.JWT_SECRET;\r\n  if (!secret) {\r\n    throw new Error(\"JWT_SECRET must be set\");\r\n  }\r\n  return secret;\r\n}\r\n\r\nexport async function hashPassword(plain: string): Promise<string> {\r\n  return bcrypt.hash(plain, 10);\r\n}\r\n\r\nexport async function verifyPassword(plain: string, hash: string): Promise<boolean> {\r\n  return bcrypt.compare(plain, hash);\r\n}\r\n\r\nexport function signAuthToken(payload: AuthTokenPayload, expiresIn = \"7d\"): string {\r\n  return jwt.sign(payload, getJwtSecret(), { expiresIn });\r\n}\r\n\r\nexport function verifyAuthToken(token: string): AuthTokenPayload | null {\r\n  try {\r\n    return jwt.verify(token, getJwtSecret()) as AuthTokenPayload;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function extractTokenFromHeader(header?: string | null): string | null {\r\n  if (!header) {\r\n    return null;\r\n  }\r\n  const [type, token] = header.split(\" \");\r\n  if (type?.toLowerCase() !== \"bearer\" || !token) {\r\n    return null;\r\n  }\r\n  return token;\r\n}\r\n\r\nexport function getTokenFromCookies(request: NextRequest): string | null {\r\n  return request.cookies.get(TOKEN_COOKIE)?.value ?? null;\r\n}\r\n\r\nexport { TOKEN_COOKIE };\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;;;AAIA,MAAM,eAAe;AAQrB,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;IACrC,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;AAEO,eAAe,aAAa,KAAa;IAC9C,OAAO,8IAAM,CAAC,IAAI,CAAC,OAAO;AAC5B;AAEO,eAAe,eAAe,KAAa,EAAE,IAAY;IAC9D,OAAO,8IAAM,CAAC,OAAO,CAAC,OAAO;AAC/B;AAEO,SAAS,cAAc,OAAyB,EAAE,YAAY,IAAI;IACvE,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,gBAAgB;QAAE;IAAU;AACvD;AAEO,SAAS,gBAAgB,KAAa;IAC3C,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,uBAAuB,MAAsB;IAC3D,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IACA,MAAM,CAAC,MAAM,MAAM,GAAG,OAAO,KAAK,CAAC;IACnC,IAAI,MAAM,kBAAkB,YAAY,CAAC,OAAO;QAC9C,OAAO;IACT;IACA,OAAO;AACT;AAEO,SAAS,oBAAoB,OAAoB;IACtD,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe,SAAS;AACrD","debugId":null}},
    {"offset": {"line": 211, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/src/lib/server-auth.ts"],"sourcesContent":["import type { NextRequest } from \"next/server\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { TOKEN_COOKIE, extractTokenFromHeader, getTokenFromCookies, verifyAuthToken } from \"@/lib/auth\";\r\n\r\nexport async function getUserFromRequest(request: NextRequest) {\r\n  const headerToken = extractTokenFromHeader(request.headers.get(\"authorization\"));\r\n  const cookieToken = getTokenFromCookies(request);\r\n  const token = headerToken ?? cookieToken;\r\n\r\n  if (!token) return null;\r\n  const payload = verifyAuthToken(token);\r\n  if (!payload) return null;\r\n\r\n  return prisma.user.findUnique({\r\n    where: { id: payload.userId },\r\n  });\r\n}\r\n\r\nexport async function requireAdmin(request: NextRequest) {\r\n  const user = await getUserFromRequest(request);\r\n  if (!user || user.role !== \"ADMIN\") {\r\n    return null;\r\n  }\r\n  return user;\r\n}\r\n\r\n// üß© uniwersalna wersja getCurrentUserFromCookies\r\nexport async function getCurrentUserFromCookies(req?: any) {\r\n  let token: string | undefined;\r\n\r\n  try {\r\n    // Pr√≥ba u≈ºycia App Router API\r\n    const { cookies } = await import(\"next/headers\");\r\n    // `cookies()` is async in this Next.js runtime and must be awaited\r\n    const cookieStore = await cookies();\r\n    token = cookieStore.get(TOKEN_COOKIE)?.value;\r\n  } catch {\r\n    // Fallback dla Pages Router (req.cookies)\r\n    token = req?.cookies?.[TOKEN_COOKIE];\r\n  }\r\n\r\n  if (!token) return null;\r\n\r\n  const payload = verifyAuthToken(token);\r\n  if (!payload) return null;\r\n\r\n  return prisma.user.findUnique({\r\n    where: { id: payload.userId },\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAEA;AACA;;;AAEO,eAAe,mBAAmB,OAAoB;IAC3D,MAAM,cAAc,IAAA,8IAAsB,EAAC,QAAQ,OAAO,CAAC,GAAG,CAAC;IAC/D,MAAM,cAAc,IAAA,2IAAmB,EAAC;IACxC,MAAM,QAAQ,eAAe;IAE7B,IAAI,CAAC,OAAO,OAAO;IACnB,MAAM,UAAU,IAAA,uIAAe,EAAC;IAChC,IAAI,CAAC,SAAS,OAAO;IAErB,OAAO,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QAC5B,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;IAC9B;AACF;AAEO,eAAe,aAAa,OAAoB;IACrD,MAAM,OAAO,MAAM,mBAAmB;IACtC,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,SAAS;QAClC,OAAO;IACT;IACA,OAAO;AACT;AAGO,eAAe,0BAA0B,GAAS;IACvD,IAAI;IAEJ,IAAI;QACF,8BAA8B;QAC9B,MAAM,EAAE,OAAO,EAAE,GAAG;QACpB,mEAAmE;QACnE,MAAM,cAAc,MAAM;QAC1B,QAAQ,YAAY,GAAG,CAAC,oIAAY,GAAG;IACzC,EAAE,OAAM;QACN,0CAA0C;QAC1C,QAAQ,KAAK,SAAS,CAAC,oIAAY,CAAC;IACtC;IAEA,IAAI,CAAC,OAAO,OAAO;IAEnB,MAAM,UAAU,IAAA,uIAAe,EAAC;IAChC,IAAI,CAAC,SAAS,OAAO;IAErB,OAAO,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QAC5B,OAAO;YAAE,IAAI,QAAQ,MAAM;QAAC;IAC9B;AACF","debugId":null}},
    {"offset": {"line": 268, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/src/app/api/songs/guess/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { buildAcceptableAnswers, normalizeAnswer, scoreForStage } from \"@/lib/game\";\r\nimport { getUserFromRequest } from \"@/lib/server-auth\";\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const { songId, guess, stageIndex, attempts = 1 } = body ?? {};\r\n\r\n    if (!songId || !guess || stageIndex === undefined) {\r\n      return NextResponse.json({ message: \"Brak wymaganych danych\" }, { status: 400 });\r\n    }\r\n\r\n    const song = await prisma.song.findUnique({ where: { id: songId } });\r\n    if (!song) {\r\n      return NextResponse.json({ message: \"Nie znaleziono piosenki\" }, { status: 404 });\r\n    }\r\n\r\n    const normalizedGuess = normalizeAnswer(guess);\r\n    const acceptable = buildAcceptableAnswers(song.title, song.artist);\r\n    const isCorrect = acceptable.some((answer) => answer === normalizedGuess);\r\n\r\n    const score = isCorrect ? scoreForStage(stageIndex, attempts) : 0;\r\n\r\n    const user = await getUserFromRequest(request);\r\n\r\n    await prisma.guessSession.create({\r\n      data: {\r\n        userId: user?.id,\r\n        songId: song.id,\r\n        isCorrect,\r\n        attempts,\r\n        score,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({\r\n      correct: isCorrect,\r\n      score,\r\n      message: isCorrect ? \"Brawo! To poprawna odpowied≈∫.\" : \"Niestety, spr√≥buj ponownie.\",\r\n      answer: isCorrect ? { title: song.title, artist: song.artist } : undefined,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Guess error\", error);\r\n    return NextResponse.json({ message: \"Nie uda≈Ço siƒô sprawdziƒá odpowiedzi\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,UAAU,EAAE,WAAW,CAAC,EAAE,GAAG,QAAQ,CAAC;QAE7D,IAAI,CAAC,UAAU,CAAC,SAAS,eAAe,WAAW;YACjD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,IAAI;YAAO;QAAE;QAClE,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,MAAM,kBAAkB,IAAA,uIAAe,EAAC;QACxC,MAAM,aAAa,IAAA,8IAAsB,EAAC,KAAK,KAAK,EAAE,KAAK,MAAM;QACjE,MAAM,YAAY,WAAW,IAAI,CAAC,CAAC,SAAW,WAAW;QAEzD,MAAM,QAAQ,YAAY,IAAA,qIAAa,EAAC,YAAY,YAAY;QAEhE,MAAM,OAAO,MAAM,IAAA,oJAAkB,EAAC;QAEtC,MAAM,gIAAM,CAAC,YAAY,CAAC,MAAM,CAAC;YAC/B,MAAM;gBACJ,QAAQ,MAAM;gBACd,QAAQ,KAAK,EAAE;gBACf;gBACA;gBACA;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA,SAAS,YAAY,kCAAkC;YACvD,QAAQ,YAAY;gBAAE,OAAO,KAAK,KAAK;gBAAE,QAAQ,KAAK,MAAM;YAAC,IAAI;QACnE;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAqC,GAAG;YAAE,QAAQ;QAAI;IAC5F;AACF","debugId":null}}]
}