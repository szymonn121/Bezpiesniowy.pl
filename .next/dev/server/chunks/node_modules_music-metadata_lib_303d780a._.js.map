{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/ogg/vorbis/VorbisDecoder.js"],"sourcesContent":["import * as Token from 'token-types';\nimport { textDecode } from '@borewit/text-codec';\nexport class VorbisDecoder {\n    constructor(data, offset) {\n        this.data = data;\n        this.offset = offset;\n    }\n    readInt32() {\n        const value = Token.UINT32_LE.get(this.data, this.offset);\n        this.offset += 4;\n        return value;\n    }\n    readStringUtf8() {\n        const len = this.readInt32();\n        const value = textDecode(this.data.subarray(this.offset, this.offset + len), 'utf-8');\n        this.offset += len;\n        return value;\n    }\n    parseUserComment() {\n        const offset0 = this.offset;\n        const v = this.readStringUtf8();\n        const idx = v.indexOf('=');\n        return {\n            key: v.substring(0, idx).toUpperCase(),\n            value: v.substring(idx + 1),\n            len: this.offset - offset0\n        };\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AACO,MAAM;IACT,YAAY,IAAI,EAAE,MAAM,CAAE;QACtB,IAAI,CAAC,IAAI,GAAG;QACZ,IAAI,CAAC,MAAM,GAAG;IAClB;IACA,YAAY;QACR,MAAM,QAAQ,6JAAe,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM;QACxD,IAAI,CAAC,MAAM,IAAI;QACf,OAAO;IACX;IACA,iBAAiB;QACb,MAAM,MAAM,IAAI,CAAC,SAAS;QAC1B,MAAM,QAAQ,IAAA,0KAAU,EAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM;QAC7E,IAAI,CAAC,MAAM,IAAI;QACf,OAAO;IACX;IACA,mBAAmB;QACf,MAAM,UAAU,IAAI,CAAC,MAAM;QAC3B,MAAM,IAAI,IAAI,CAAC,cAAc;QAC7B,MAAM,MAAM,EAAE,OAAO,CAAC;QACtB,OAAO;YACH,KAAK,EAAE,SAAS,CAAC,GAAG,KAAK,WAAW;YACpC,OAAO,EAAE,SAAS,CAAC,MAAM;YACzB,KAAK,IAAI,CAAC,MAAM,GAAG;QACvB;IACJ;AACJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/ogg/vorbis/Vorbis.js"],"sourcesContent":["import * as Token from 'token-types';\nimport { AttachedPictureType } from '../../id3v2/ID3v2Token.js';\n/**\n * Parse the METADATA_BLOCK_PICTURE\n * Ref: https://wiki.xiph.org/VorbisComment#METADATA_BLOCK_PICTURE\n * Ref: https://xiph.org/flac/format.html#metadata_block_picture\n * // ToDo: move to ID3 / APIC?\n */\nexport class VorbisPictureToken {\n    static fromBase64(base64str) {\n        return VorbisPictureToken.fromBuffer(Uint8Array.from(atob(base64str), c => c.charCodeAt(0)));\n    }\n    static fromBuffer(buffer) {\n        const pic = new VorbisPictureToken(buffer.length);\n        return pic.get(buffer, 0);\n    }\n    constructor(len) {\n        this.len = len;\n    }\n    get(buffer, offset) {\n        const type = AttachedPictureType[Token.UINT32_BE.get(buffer, offset)];\n        offset += 4;\n        const mimeLen = Token.UINT32_BE.get(buffer, offset);\n        offset += 4;\n        const format = new Token.StringType(mimeLen, 'utf-8').get(buffer, offset);\n        offset += mimeLen;\n        const descLen = Token.UINT32_BE.get(buffer, offset);\n        offset += 4;\n        const description = new Token.StringType(descLen, 'utf-8').get(buffer, offset);\n        offset += descLen;\n        const width = Token.UINT32_BE.get(buffer, offset);\n        offset += 4;\n        const height = Token.UINT32_BE.get(buffer, offset);\n        offset += 4;\n        const colour_depth = Token.UINT32_BE.get(buffer, offset);\n        offset += 4;\n        const indexed_color = Token.UINT32_BE.get(buffer, offset);\n        offset += 4;\n        const picDataLen = Token.UINT32_BE.get(buffer, offset);\n        offset += 4;\n        const data = buffer.slice(offset, offset + picDataLen);\n        return {\n            type,\n            format,\n            description,\n            width,\n            height,\n            colour_depth,\n            indexed_color,\n            data\n        };\n    }\n}\n/**\n * Comment header decoder\n * Ref: https://xiph.org/vorbis/doc/Vorbis_I_spec.html#x1-620004.2.1\n */\nexport const CommonHeader = {\n    len: 7,\n    get: (buf, off) => {\n        return {\n            packetType: Token.UINT8.get(buf, off),\n            vorbis: new Token.StringType(6, 'ascii').get(buf, off + 1)\n        };\n    }\n};\n/**\n * Identification header decoder\n * Ref: https://xiph.org/vorbis/doc/Vorbis_I_spec.html#x1-630004.2.2\n */\nexport const IdentificationHeader = {\n    len: 23,\n    get: (uint8Array, off) => {\n        return {\n            version: Token.UINT32_LE.get(uint8Array, off + 0),\n            channelMode: Token.UINT8.get(uint8Array, off + 4),\n            sampleRate: Token.UINT32_LE.get(uint8Array, off + 5),\n            bitrateMax: Token.UINT32_LE.get(uint8Array, off + 9),\n            bitrateNominal: Token.UINT32_LE.get(uint8Array, off + 13),\n            bitrateMin: Token.UINT32_LE.get(uint8Array, off + 17)\n        };\n    }\n};\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAOO,MAAM;IACT,OAAO,WAAW,SAAS,EAAE;QACzB,OAAO,mBAAmB,UAAU,CAAC,WAAW,IAAI,CAAC,KAAK,YAAY,CAAA,IAAK,EAAE,UAAU,CAAC;IAC5F;IACA,OAAO,WAAW,MAAM,EAAE;QACtB,MAAM,MAAM,IAAI,mBAAmB,OAAO,MAAM;QAChD,OAAO,IAAI,GAAG,CAAC,QAAQ;IAC3B;IACA,YAAY,GAAG,CAAE;QACb,IAAI,CAAC,GAAG,GAAG;IACf;IACA,IAAI,MAAM,EAAE,MAAM,EAAE;QAChB,MAAM,OAAO,wLAAmB,CAAC,6JAAe,CAAC,GAAG,CAAC,QAAQ,QAAQ;QACrE,UAAU;QACV,MAAM,UAAU,6JAAe,CAAC,GAAG,CAAC,QAAQ;QAC5C,UAAU;QACV,MAAM,SAAS,IAAI,8JAAgB,CAAC,SAAS,SAAS,GAAG,CAAC,QAAQ;QAClE,UAAU;QACV,MAAM,UAAU,6JAAe,CAAC,GAAG,CAAC,QAAQ;QAC5C,UAAU;QACV,MAAM,cAAc,IAAI,8JAAgB,CAAC,SAAS,SAAS,GAAG,CAAC,QAAQ;QACvE,UAAU;QACV,MAAM,QAAQ,6JAAe,CAAC,GAAG,CAAC,QAAQ;QAC1C,UAAU;QACV,MAAM,SAAS,6JAAe,CAAC,GAAG,CAAC,QAAQ;QAC3C,UAAU;QACV,MAAM,eAAe,6JAAe,CAAC,GAAG,CAAC,QAAQ;QACjD,UAAU;QACV,MAAM,gBAAgB,6JAAe,CAAC,GAAG,CAAC,QAAQ;QAClD,UAAU;QACV,MAAM,aAAa,6JAAe,CAAC,GAAG,CAAC,QAAQ;QAC/C,UAAU;QACV,MAAM,OAAO,OAAO,KAAK,CAAC,QAAQ,SAAS;QAC3C,OAAO;YACH;YACA;YACA;YACA;YACA;YACA;YACA;YACA;QACJ;IACJ;AACJ;AAKO,MAAM,eAAe;IACxB,KAAK;IACL,KAAK,CAAC,KAAK;QACP,OAAO;YACH,YAAY,yJAAW,CAAC,GAAG,CAAC,KAAK;YACjC,QAAQ,IAAI,8JAAgB,CAAC,GAAG,SAAS,GAAG,CAAC,KAAK,MAAM;QAC5D;IACJ;AACJ;AAKO,MAAM,uBAAuB;IAChC,KAAK;IACL,KAAK,CAAC,YAAY;QACd,OAAO;YACH,SAAS,6JAAe,CAAC,GAAG,CAAC,YAAY,MAAM;YAC/C,aAAa,yJAAW,CAAC,GAAG,CAAC,YAAY,MAAM;YAC/C,YAAY,6JAAe,CAAC,GAAG,CAAC,YAAY,MAAM;YAClD,YAAY,6JAAe,CAAC,GAAG,CAAC,YAAY,MAAM;YAClD,gBAAgB,6JAAe,CAAC,GAAG,CAAC,YAAY,MAAM;YACtD,YAAY,6JAAe,CAAC,GAAG,CAAC,YAAY,MAAM;QACtD;IACJ;AACJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 126, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/ogg/vorbis/VorbisStream.js"],"sourcesContent":["import * as Token from 'token-types';\nimport debugInit from 'debug';\nimport { VorbisDecoder } from './VorbisDecoder.js';\nimport { CommonHeader, IdentificationHeader, VorbisPictureToken } from './Vorbis.js';\nimport { makeUnexpectedFileContentError } from '../../ParseError.js';\nconst debug = debugInit('music-metadata:parser:ogg:vorbis1');\nexport class VorbisContentError extends makeUnexpectedFileContentError('Vorbis') {\n}\n/**\n * Vorbis 1 Parser.\n * Used by OggStream\n */\nexport class VorbisStream {\n    constructor(metadata, options) {\n        this.pageSegments = [];\n        this.durationOnLastPage = true;\n        this.metadata = metadata;\n        this.options = options;\n    }\n    /**\n     * Vorbis 1 parser\n     * @param header Ogg Page Header\n     * @param pageData Page data\n     */\n    async parsePage(header, pageData) {\n        this.lastPageHeader = header;\n        if (header.headerType.firstPage) {\n            this.parseFirstPage(header, pageData);\n        }\n        else {\n            if (header.headerType.continued) {\n                if (this.pageSegments.length === 0) {\n                    throw new VorbisContentError('Cannot continue on previous page');\n                }\n                this.pageSegments.push(pageData);\n            }\n            if (header.headerType.lastPage || !header.headerType.continued) {\n                // Flush page segments\n                if (this.pageSegments.length > 0) {\n                    const fullPage = VorbisStream.mergeUint8Arrays(this.pageSegments);\n                    await this.parseFullPage(fullPage);\n                }\n                // Reset page segments\n                this.pageSegments = header.headerType.lastPage ? [] : [pageData];\n            }\n        }\n    }\n    static mergeUint8Arrays(arrays) {\n        const totalSize = arrays.reduce((acc, e) => acc + e.length, 0);\n        const merged = new Uint8Array(totalSize);\n        arrays.forEach((array, i, _arrays) => {\n            const offset = _arrays.slice(0, i).reduce((acc, e) => acc + e.length, 0);\n            merged.set(array, offset);\n        });\n        return merged;\n    }\n    async flush() {\n        await this.parseFullPage(VorbisStream.mergeUint8Arrays(this.pageSegments));\n    }\n    async parseUserComment(pageData, offset) {\n        const decoder = new VorbisDecoder(pageData, offset);\n        const tag = decoder.parseUserComment();\n        await this.addTag(tag.key, tag.value);\n        return tag.len;\n    }\n    async addTag(id, value) {\n        if (id === 'METADATA_BLOCK_PICTURE' && (typeof value === 'string')) {\n            if (this.options.skipCovers) {\n                debug(\"Ignore picture\");\n                return;\n            }\n            value = VorbisPictureToken.fromBase64(value);\n            debug(`Push picture: id=${id}, format=${value.format}`);\n        }\n        else {\n            debug(`Push tag: id=${id}, value=${value}`);\n        }\n        await this.metadata.addTag('vorbis', id, value);\n    }\n    calculateDuration() {\n        if (this.lastPageHeader && this.metadata.format.sampleRate && this.lastPageHeader.absoluteGranulePosition >= 0) {\n            // Calculate duration\n            this.metadata.setFormat('numberOfSamples', this.lastPageHeader.absoluteGranulePosition);\n            this.metadata.setFormat('duration', this.lastPageHeader.absoluteGranulePosition / this.metadata.format.sampleRate);\n        }\n    }\n    /**\n     * Parse first Ogg/Vorbis page\n     * @param _header\n     * @param pageData\n     */\n    parseFirstPage(_header, pageData) {\n        this.metadata.setFormat('codec', 'Vorbis I');\n        this.metadata.setFormat('hasAudio', true);\n        debug('Parse first page');\n        // Parse  Vorbis common header\n        const commonHeader = CommonHeader.get(pageData, 0);\n        if (commonHeader.vorbis !== 'vorbis')\n            throw new VorbisContentError('Metadata does not look like Vorbis');\n        if (commonHeader.packetType === 1) {\n            const idHeader = IdentificationHeader.get(pageData, CommonHeader.len);\n            this.metadata.setFormat('sampleRate', idHeader.sampleRate);\n            this.metadata.setFormat('bitrate', idHeader.bitrateNominal);\n            this.metadata.setFormat('numberOfChannels', idHeader.channelMode);\n            debug('sample-rate=%s[hz], bitrate=%s[b/s], channel-mode=%s', idHeader.sampleRate, idHeader.bitrateNominal, idHeader.channelMode);\n        }\n        else\n            throw new VorbisContentError('First Ogg page should be type 1: the identification header');\n    }\n    async parseFullPage(pageData) {\n        // New page\n        const commonHeader = CommonHeader.get(pageData, 0);\n        debug('Parse full page: type=%s, byteLength=%s', commonHeader.packetType, pageData.byteLength);\n        switch (commonHeader.packetType) {\n            case 3: //  type 3: comment header\n                return this.parseUserCommentList(pageData, CommonHeader.len);\n            case 1: // type 1: the identification header\n            case 5: // type 5: setup header type\n                break; // ignore\n        }\n    }\n    /**\n     * Ref: https://xiph.org/vorbis/doc/Vorbis_I_spec.html#x1-840005.2\n     */\n    async parseUserCommentList(pageData, offset) {\n        const strLen = Token.UINT32_LE.get(pageData, offset);\n        offset += 4;\n        // const vendorString = new Token.StringType(strLen, 'utf-8').get(pageData, offset);\n        offset += strLen;\n        let userCommentListLength = Token.UINT32_LE.get(pageData, offset);\n        offset += 4;\n        while (userCommentListLength-- > 0) {\n            offset += (await this.parseUserComment(pageData, offset));\n        }\n    }\n}\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 267, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/ogg/opus/Opus.js"],"sourcesContent":["import * as Token from 'token-types';\nimport { makeUnexpectedFileContentError } from '../../ParseError.js';\nexport class OpusContentError extends makeUnexpectedFileContentError('Opus') {\n}\n/**\n * Opus ID Header parser\n * Ref: https://wiki.xiph.org/OggOpus#ID_Header\n */\nexport class IdHeader {\n    constructor(len) {\n        if (len < 19) {\n            throw new OpusContentError('ID-header-page 0 should be at least 19 bytes long');\n        }\n        this.len = len;\n    }\n    get(buf, off) {\n        return {\n            magicSignature: new Token.StringType(8, 'ascii').get(buf, off + 0),\n            version: Token.UINT8.get(buf, off + 8),\n            channelCount: Token.UINT8.get(buf, off + 9),\n            preSkip: Token.UINT16_LE.get(buf, off + 10),\n            inputSampleRate: Token.UINT32_LE.get(buf, off + 12),\n            outputGain: Token.UINT16_LE.get(buf, off + 16),\n            channelMapping: Token.UINT8.get(buf, off + 18)\n        };\n    }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AACO,MAAM,yBAAyB,IAAA,0LAA8B,EAAC;AACrE;AAKO,MAAM;IACT,YAAY,GAAG,CAAE;QACb,IAAI,MAAM,IAAI;YACV,MAAM,IAAI,iBAAiB;QAC/B;QACA,IAAI,CAAC,GAAG,GAAG;IACf;IACA,IAAI,GAAG,EAAE,GAAG,EAAE;QACV,OAAO;YACH,gBAAgB,IAAI,8JAAgB,CAAC,GAAG,SAAS,GAAG,CAAC,KAAK,MAAM;YAChE,SAAS,yJAAW,CAAC,GAAG,CAAC,KAAK,MAAM;YACpC,cAAc,yJAAW,CAAC,GAAG,CAAC,KAAK,MAAM;YACzC,SAAS,6JAAe,CAAC,GAAG,CAAC,KAAK,MAAM;YACxC,iBAAiB,6JAAe,CAAC,GAAG,CAAC,KAAK,MAAM;YAChD,YAAY,6JAAe,CAAC,GAAG,CAAC,KAAK,MAAM;YAC3C,gBAAgB,yJAAW,CAAC,GAAG,CAAC,KAAK,MAAM;QAC/C;IACJ;AACJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 302, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/ogg/opus/OpusStream.js"],"sourcesContent":["import * as Token from 'token-types';\nimport { VorbisStream } from '../vorbis/VorbisStream.js';\nimport * as Opus from './Opus.js';\nimport { OpusContentError } from './Opus.js';\n/**\n * Opus parser\n * Internet Engineering Task Force (IETF) - RFC 6716\n * Used by OggStream\n */\nexport class OpusStream extends VorbisStream {\n    constructor(metadata, options, tokenizer) {\n        super(metadata, options);\n        this.idHeader = null;\n        this.lastPos = -1;\n        this.tokenizer = tokenizer;\n        this.durationOnLastPage = true;\n    }\n    /**\n     * Parse first Opus Ogg page\n     * @param {IPageHeader} header\n     * @param {Uint8Array} pageData\n     */\n    parseFirstPage(_header, pageData) {\n        this.metadata.setFormat('codec', 'Opus');\n        // Parse Opus ID Header\n        this.idHeader = new Opus.IdHeader(pageData.length).get(pageData, 0);\n        if (this.idHeader.magicSignature !== \"OpusHead\")\n            throw new OpusContentError(\"Illegal ogg/Opus magic-signature\");\n        this.metadata.setFormat('sampleRate', this.idHeader.inputSampleRate);\n        this.metadata.setFormat('numberOfChannels', this.idHeader.channelCount);\n        this.metadata.setAudioOnly();\n    }\n    async parseFullPage(pageData) {\n        const magicSignature = new Token.StringType(8, 'ascii').get(pageData, 0);\n        switch (magicSignature) {\n            case 'OpusTags':\n                await this.parseUserCommentList(pageData, 8);\n                this.lastPos = this.tokenizer.position - pageData.length;\n                break;\n            default:\n                break;\n        }\n    }\n    calculateDuration() {\n        if (this.lastPageHeader && this.metadata.format.sampleRate && this.lastPageHeader.absoluteGranulePosition >= 0) {\n            // Calculate duration\n            const pos_48bit = this.lastPageHeader.absoluteGranulePosition - this.idHeader.preSkip;\n            this.metadata.setFormat('numberOfSamples', pos_48bit);\n            this.metadata.setFormat('duration', pos_48bit / 48000);\n            if (this.lastPos !== -1 && this.tokenizer.fileInfo.size && this.metadata.format.duration) {\n                const dataSize = this.tokenizer.fileInfo.size - this.lastPos;\n                this.metadata.setFormat('bitrate', 8 * dataSize / this.metadata.format.duration);\n            }\n        }\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;AAOO,MAAM,mBAAmB,2LAAY;IACxC,YAAY,QAAQ,EAAE,OAAO,EAAE,SAAS,CAAE;QACtC,KAAK,CAAC,UAAU;QAChB,IAAI,CAAC,QAAQ,GAAG;QAChB,IAAI,CAAC,OAAO,GAAG,CAAC;QAChB,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,CAAC,kBAAkB,GAAG;IAC9B;IACA;;;;KAIC,GACD,eAAe,OAAO,EAAE,QAAQ,EAAE;QAC9B,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,SAAS;QACjC,uBAAuB;QACvB,IAAI,CAAC,QAAQ,GAAG,IAAI,6KAAa,CAAC,SAAS,MAAM,EAAE,GAAG,CAAC,UAAU;QACjE,IAAI,IAAI,CAAC,QAAQ,CAAC,cAAc,KAAK,YACjC,MAAM,IAAI,qLAAgB,CAAC;QAC/B,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,cAAc,IAAI,CAAC,QAAQ,CAAC,eAAe;QACnE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,oBAAoB,IAAI,CAAC,QAAQ,CAAC,YAAY;QACtE,IAAI,CAAC,QAAQ,CAAC,YAAY;IAC9B;IACA,MAAM,cAAc,QAAQ,EAAE;QAC1B,MAAM,iBAAiB,IAAI,8JAAgB,CAAC,GAAG,SAAS,GAAG,CAAC,UAAU;QACtE,OAAQ;YACJ,KAAK;gBACD,MAAM,IAAI,CAAC,oBAAoB,CAAC,UAAU;gBAC1C,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,GAAG,SAAS,MAAM;gBACxD;YACJ;gBACI;QACR;IACJ;IACA,oBAAoB;QAChB,IAAI,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,UAAU,IAAI,IAAI,CAAC,cAAc,CAAC,uBAAuB,IAAI,GAAG;YAC5G,qBAAqB;YACrB,MAAM,YAAY,IAAI,CAAC,cAAc,CAAC,uBAAuB,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO;YACrF,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,mBAAmB;YAC3C,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,YAAY,YAAY;YAChD,IAAI,IAAI,CAAC,OAAO,KAAK,CAAC,KAAK,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,EAAE;gBACtF,MAAM,WAAW,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,GAAG,IAAI,CAAC,OAAO;gBAC5D,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,WAAW,IAAI,WAAW,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ;YACnF;QACJ;IACJ;AACJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 362, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/ogg/speex/Speex.js"],"sourcesContent":["import * as Token from 'token-types';\nimport * as util from '../../common/Util.js';\n/**\n * Speex Header Packet\n * Ref: https://www.speex.org/docs/manual/speex-manual/node8.html#SECTION00830000000000000000\n */\nexport const Header = {\n    len: 80,\n    get: (buf, off) => {\n        return {\n            speex: new Token.StringType(8, 'ascii').get(buf, off + 0),\n            version: util.trimRightNull(new Token.StringType(20, 'ascii').get(buf, off + 8)),\n            version_id: Token.INT32_LE.get(buf, off + 28),\n            header_size: Token.INT32_LE.get(buf, off + 32),\n            rate: Token.INT32_LE.get(buf, off + 36),\n            mode: Token.INT32_LE.get(buf, off + 40),\n            mode_bitstream_version: Token.INT32_LE.get(buf, off + 44),\n            nb_channels: Token.INT32_LE.get(buf, off + 48),\n            bitrate: Token.INT32_LE.get(buf, off + 52),\n            frame_size: Token.INT32_LE.get(buf, off + 56),\n            vbr: Token.INT32_LE.get(buf, off + 60),\n            frames_per_packet: Token.INT32_LE.get(buf, off + 64),\n            extra_headers: Token.INT32_LE.get(buf, off + 68),\n            reserved1: Token.INT32_LE.get(buf, off + 72),\n            reserved2: Token.INT32_LE.get(buf, off + 76)\n        };\n    }\n};\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAKO,MAAM,SAAS;IAClB,KAAK;IACL,KAAK,CAAC,KAAK;QACP,OAAO;YACH,OAAO,IAAI,8JAAgB,CAAC,GAAG,SAAS,GAAG,CAAC,KAAK,MAAM;YACvD,SAAS,6KAAkB,CAAC,IAAI,8JAAgB,CAAC,IAAI,SAAS,GAAG,CAAC,KAAK,MAAM;YAC7E,YAAY,4JAAc,CAAC,GAAG,CAAC,KAAK,MAAM;YAC1C,aAAa,4JAAc,CAAC,GAAG,CAAC,KAAK,MAAM;YAC3C,MAAM,4JAAc,CAAC,GAAG,CAAC,KAAK,MAAM;YACpC,MAAM,4JAAc,CAAC,GAAG,CAAC,KAAK,MAAM;YACpC,wBAAwB,4JAAc,CAAC,GAAG,CAAC,KAAK,MAAM;YACtD,aAAa,4JAAc,CAAC,GAAG,CAAC,KAAK,MAAM;YAC3C,SAAS,4JAAc,CAAC,GAAG,CAAC,KAAK,MAAM;YACvC,YAAY,4JAAc,CAAC,GAAG,CAAC,KAAK,MAAM;YAC1C,KAAK,4JAAc,CAAC,GAAG,CAAC,KAAK,MAAM;YACnC,mBAAmB,4JAAc,CAAC,GAAG,CAAC,KAAK,MAAM;YACjD,eAAe,4JAAc,CAAC,GAAG,CAAC,KAAK,MAAM;YAC7C,WAAW,4JAAc,CAAC,GAAG,CAAC,KAAK,MAAM;YACzC,WAAW,4JAAc,CAAC,GAAG,CAAC,KAAK,MAAM;QAC7C;IACJ;AACJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 396, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/ogg/speex/SpeexStream.js"],"sourcesContent":["import initDebug from 'debug';\nimport { VorbisStream } from '../vorbis/VorbisStream.js';\nimport * as Speex from './Speex.js';\nconst debug = initDebug('music-metadata:parser:ogg:speex');\n/**\n * Speex, RFC 5574\n * Ref:\n * - https://www.speex.org/docs/manual/speex-manual/\n * - https://tools.ietf.org/html/rfc5574\n */\nexport class SpeexStream extends VorbisStream {\n    constructor(metadata, options, _tokenizer) {\n        super(metadata, options);\n    }\n    /**\n     * Parse first Speex Ogg page\n     * @param {IPageHeader} header\n     * @param {Uint8Array} pageData\n     */\n    parseFirstPage(_header, pageData) {\n        debug('First Ogg/Speex page');\n        const speexHeader = Speex.Header.get(pageData, 0);\n        this.metadata.setFormat('codec', `Speex ${speexHeader.version}`);\n        this.metadata.setFormat('numberOfChannels', speexHeader.nb_channels);\n        this.metadata.setFormat('sampleRate', speexHeader.rate);\n        if (speexHeader.bitrate !== -1) {\n            this.metadata.setFormat('bitrate', speexHeader.bitrate);\n        }\n        this.metadata.setAudioOnly();\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AACA,MAAM,QAAQ,IAAA,kJAAS,EAAC;AAOjB,MAAM,oBAAoB,2LAAY;IACzC,YAAY,QAAQ,EAAE,OAAO,EAAE,UAAU,CAAE;QACvC,KAAK,CAAC,UAAU;IACpB;IACA;;;;KAIC,GACD,eAAe,OAAO,EAAE,QAAQ,EAAE;QAC9B,MAAM;QACN,MAAM,cAAc,6KAAY,CAAC,GAAG,CAAC,UAAU;QAC/C,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,SAAS,CAAC,MAAM,EAAE,YAAY,OAAO,EAAE;QAC/D,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,oBAAoB,YAAY,WAAW;QACnE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,cAAc,YAAY,IAAI;QACtD,IAAI,YAAY,OAAO,KAAK,CAAC,GAAG;YAC5B,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,WAAW,YAAY,OAAO;QAC1D;QACA,IAAI,CAAC,QAAQ,CAAC,YAAY;IAC9B;AACJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 431, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/ogg/theora/Theora.js"],"sourcesContent":["import * as Token from 'token-types';\n/**\n * 6.2 Identification Header\n * Ref: https://theora.org/doc/Theora.pdf: 6.2 Identification Header Decode\n */\nexport const IdentificationHeader = {\n    len: 42,\n    get: (buf, off) => {\n        return {\n            id: new Token.StringType(7, 'ascii').get(buf, off),\n            vmaj: Token.UINT8.get(buf, off + 7),\n            vmin: Token.UINT8.get(buf, off + 8),\n            vrev: Token.UINT8.get(buf, off + 9),\n            vmbw: Token.UINT16_BE.get(buf, off + 10),\n            vmbh: Token.UINT16_BE.get(buf, off + 17),\n            nombr: Token.UINT24_BE.get(buf, off + 37),\n            nqual: Token.UINT8.get(buf, off + 40)\n        };\n    }\n};\n"],"names":[],"mappings":";;;;AAAA;;AAKO,MAAM,uBAAuB;IAChC,KAAK;IACL,KAAK,CAAC,KAAK;QACP,OAAO;YACH,IAAI,IAAI,8JAAgB,CAAC,GAAG,SAAS,GAAG,CAAC,KAAK;YAC9C,MAAM,yJAAW,CAAC,GAAG,CAAC,KAAK,MAAM;YACjC,MAAM,yJAAW,CAAC,GAAG,CAAC,KAAK,MAAM;YACjC,MAAM,yJAAW,CAAC,GAAG,CAAC,KAAK,MAAM;YACjC,MAAM,6JAAe,CAAC,GAAG,CAAC,KAAK,MAAM;YACrC,MAAM,6JAAe,CAAC,GAAG,CAAC,KAAK,MAAM;YACrC,OAAO,6JAAe,CAAC,GAAG,CAAC,KAAK,MAAM;YACtC,OAAO,yJAAW,CAAC,GAAG,CAAC,KAAK,MAAM;QACtC;IACJ;AACJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 456, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/ogg/theora/TheoraStream.js"],"sourcesContent":["import initDebug from 'debug';\nimport { IdentificationHeader } from './Theora.js';\nconst debug = initDebug('music-metadata:parser:ogg:theora');\n/**\n * Ref:\n * - https://theora.org/doc/Theora.pdf\n */\nexport class TheoraStream {\n    constructor(metadata, _options, _tokenizer) {\n        this.durationOnLastPage = false;\n        this.metadata = metadata;\n    }\n    /**\n     * Vorbis 1 parser\n     * @param header Ogg Page Header\n     * @param pageData Page data\n     */\n    async parsePage(header, pageData) {\n        if (header.headerType.firstPage) {\n            await this.parseFirstPage(header, pageData);\n        }\n    }\n    calculateDuration() {\n        debug('duration calculation not implemented');\n    }\n    /**\n     * Parse first Theora Ogg page. the initial identification header packet\n     */\n    async parseFirstPage(_header, pageData) {\n        debug('First Ogg/Theora page');\n        this.metadata.setFormat('codec', 'Theora');\n        const idHeader = IdentificationHeader.get(pageData, 0);\n        this.metadata.setFormat('bitrate', idHeader.nombr);\n        this.metadata.setFormat('hasVideo', true);\n    }\n    flush() {\n        return Promise.resolve();\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AACA,MAAM,QAAQ,IAAA,kJAAS,EAAC;AAKjB,MAAM;IACT,YAAY,QAAQ,EAAE,QAAQ,EAAE,UAAU,CAAE;QACxC,IAAI,CAAC,kBAAkB,GAAG;QAC1B,IAAI,CAAC,QAAQ,GAAG;IACpB;IACA;;;;KAIC,GACD,MAAM,UAAU,MAAM,EAAE,QAAQ,EAAE;QAC9B,IAAI,OAAO,UAAU,CAAC,SAAS,EAAE;YAC7B,MAAM,IAAI,CAAC,cAAc,CAAC,QAAQ;QACtC;IACJ;IACA,oBAAoB;QAChB,MAAM;IACV;IACA;;KAEC,GACD,MAAM,eAAe,OAAO,EAAE,QAAQ,EAAE;QACpC,MAAM;QACN,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,SAAS;QACjC,MAAM,WAAW,6LAAoB,CAAC,GAAG,CAAC,UAAU;QACpD,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,WAAW,SAAS,KAAK;QACjD,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,YAAY;IACxC;IACA,QAAQ;QACJ,OAAO,QAAQ,OAAO;IAC1B;AACJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 499, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/ogg/OggToken.js"],"sourcesContent":["import * as Token from 'token-types';\nimport * as util from '../common/Util.js';\nimport { StringType } from 'token-types';\nexport const PageHeader = {\n    len: 27,\n    get: (buf, off) => {\n        return {\n            capturePattern: new StringType(4, 'latin1').get(buf, off),\n            version: Token.UINT8.get(buf, off + 4),\n            headerType: {\n                continued: util.getBit(buf, off + 5, 0),\n                firstPage: util.getBit(buf, off + 5, 1),\n                lastPage: util.getBit(buf, off + 5, 2)\n            },\n            // packet_flag: Token.UINT8.get(buf, off + 5),\n            absoluteGranulePosition: Number(Token.UINT64_LE.get(buf, off + 6)),\n            streamSerialNumber: Token.UINT32_LE.get(buf, off + 14),\n            pageSequenceNo: Token.UINT32_LE.get(buf, off + 18),\n            pageChecksum: Token.UINT32_LE.get(buf, off + 22),\n            page_segments: Token.UINT8.get(buf, off + 26)\n        };\n    }\n};\nexport class SegmentTable {\n    static sum(buf, off, len) {\n        const dv = new DataView(buf.buffer, 0);\n        let s = 0;\n        for (let i = off; i < off + len; ++i) {\n            s += dv.getUint8(i);\n        }\n        return s;\n    }\n    constructor(header) {\n        this.len = header.page_segments;\n    }\n    get(buf, off) {\n        return {\n            totalPageSize: SegmentTable.sum(buf, off, this.len)\n        };\n    }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;AAEO,MAAM,aAAa;IACtB,KAAK;IACL,KAAK,CAAC,KAAK;QACP,OAAO;YACH,gBAAgB,IAAI,8JAAU,CAAC,GAAG,UAAU,GAAG,CAAC,KAAK;YACrD,SAAS,yJAAW,CAAC,GAAG,CAAC,KAAK,MAAM;YACpC,YAAY;gBACR,WAAW,sKAAW,CAAC,KAAK,MAAM,GAAG;gBACrC,WAAW,sKAAW,CAAC,KAAK,MAAM,GAAG;gBACrC,UAAU,sKAAW,CAAC,KAAK,MAAM,GAAG;YACxC;YACA,8CAA8C;YAC9C,yBAAyB,OAAO,6JAAe,CAAC,GAAG,CAAC,KAAK,MAAM;YAC/D,oBAAoB,6JAAe,CAAC,GAAG,CAAC,KAAK,MAAM;YACnD,gBAAgB,6JAAe,CAAC,GAAG,CAAC,KAAK,MAAM;YAC/C,cAAc,6JAAe,CAAC,GAAG,CAAC,KAAK,MAAM;YAC7C,eAAe,yJAAW,CAAC,GAAG,CAAC,KAAK,MAAM;QAC9C;IACJ;AACJ;AACO,MAAM;IACT,OAAO,IAAI,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE;QACtB,MAAM,KAAK,IAAI,SAAS,IAAI,MAAM,EAAE;QACpC,IAAI,IAAI;QACR,IAAK,IAAI,IAAI,KAAK,IAAI,MAAM,KAAK,EAAE,EAAG;YAClC,KAAK,GAAG,QAAQ,CAAC;QACrB;QACA,OAAO;IACX;IACA,YAAY,MAAM,CAAE;QAChB,IAAI,CAAC,GAAG,GAAG,OAAO,aAAa;IACnC;IACA,IAAI,GAAG,EAAE,GAAG,EAAE;QACV,OAAO;YACH,eAAe,aAAa,GAAG,CAAC,KAAK,KAAK,IAAI,CAAC,GAAG;QACtD;IACJ;AACJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 552, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/flac/FlacToken.js"],"sourcesContent":["import * as util from '../common/Util.js';\nimport { UINT16_BE, UINT24_BE, Uint8ArrayType } from 'token-types';\n/**\n * FLAC supports up to 128 kinds of metadata blocks; currently the following are defined:\n * ref: https://xiph.org/flac/format.html#metadata_block\n */\nexport const BlockType = {\n    STREAMINFO: 0, // STREAMINFO\n    PADDING: 1, // PADDING\n    APPLICATION: 2, // APPLICATION\n    SEEKTABLE: 3, // SEEKTABLE\n    VORBIS_COMMENT: 4, // VORBIS_COMMENT\n    CUESHEET: 5, // CUESHEET\n    PICTURE: 6 // PICTURE\n};\nexport const BlockHeader = {\n    len: 4,\n    get: (buf, off) => {\n        return {\n            lastBlock: util.getBit(buf, off, 7),\n            type: util.getBitAllignedNumber(buf, off, 1, 7),\n            length: UINT24_BE.get(buf, off + 1)\n        };\n    }\n};\n/**\n * METADATA_BLOCK_DATA\n * Ref: https://xiph.org/flac/format.html#metadata_block_streaminfo\n */\nexport const BlockStreamInfo = {\n    len: 34,\n    get: (buf, off) => {\n        return {\n            // The minimum block size (in samples) used in the stream.\n            minimumBlockSize: UINT16_BE.get(buf, off),\n            // The maximum block size (in samples) used in the stream.\n            // (Minimum blocksize == maximum blocksize) implies a fixed-blocksize stream.\n            maximumBlockSize: UINT16_BE.get(buf, off + 2) / 1000,\n            // The minimum frame size (in bytes) used in the stream.\n            // May be 0 to imply the value is not known.\n            minimumFrameSize: UINT24_BE.get(buf, off + 4),\n            // The maximum frame size (in bytes) used in the stream.\n            // May be 0 to imply the value is not known.\n            maximumFrameSize: UINT24_BE.get(buf, off + 7),\n            // Sample rate in Hz. Though 20 bits are available,\n            // the maximum sample rate is limited by the structure of frame headers to 655350Hz.\n            // Also, a value of 0 is invalid.\n            sampleRate: UINT24_BE.get(buf, off + 10) >> 4,\n            // probably slower: sampleRate: common.getBitAllignedNumber(buf, off + 10, 0, 20),\n            // (number of channels)-1. FLAC supports from 1 to 8 channels\n            channels: util.getBitAllignedNumber(buf, off + 12, 4, 3) + 1,\n            // bits per sample)-1.\n            // FLAC supports from 4 to 32 bits per sample. Currently the reference encoder and decoders only support up to 24 bits per sample.\n            bitsPerSample: util.getBitAllignedNumber(buf, off + 12, 7, 5) + 1,\n            // Total samples in stream.\n            // 'Samples' means inter-channel sample, i.e. one second of 44.1Khz audio will have 44100 samples regardless of the number of channels.\n            // A value of zero here means the number of total samples is unknown.\n            totalSamples: util.getBitAllignedNumber(buf, off + 13, 4, 36),\n            // the MD5 hash of the file (see notes for usage... it's a littly tricky)\n            fileMD5: new Uint8ArrayType(16).get(buf, off + 18)\n        };\n    }\n};\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAKO,MAAM,YAAY;IACrB,YAAY;IACZ,SAAS;IACT,aAAa;IACb,WAAW;IACX,gBAAgB;IAChB,UAAU;IACV,SAAS,EAAE,UAAU;AACzB;AACO,MAAM,cAAc;IACvB,KAAK;IACL,KAAK,CAAC,KAAK;QACP,OAAO;YACH,WAAW,sKAAW,CAAC,KAAK,KAAK;YACjC,MAAM,oLAAyB,CAAC,KAAK,KAAK,GAAG;YAC7C,QAAQ,6JAAS,CAAC,GAAG,CAAC,KAAK,MAAM;QACrC;IACJ;AACJ;AAKO,MAAM,kBAAkB;IAC3B,KAAK;IACL,KAAK,CAAC,KAAK;QACP,OAAO;YACH,0DAA0D;YAC1D,kBAAkB,6JAAS,CAAC,GAAG,CAAC,KAAK;YACrC,0DAA0D;YAC1D,6EAA6E;YAC7E,kBAAkB,6JAAS,CAAC,GAAG,CAAC,KAAK,MAAM,KAAK;YAChD,wDAAwD;YACxD,4CAA4C;YAC5C,kBAAkB,6JAAS,CAAC,GAAG,CAAC,KAAK,MAAM;YAC3C,wDAAwD;YACxD,4CAA4C;YAC5C,kBAAkB,6JAAS,CAAC,GAAG,CAAC,KAAK,MAAM;YAC3C,mDAAmD;YACnD,oFAAoF;YACpF,iCAAiC;YACjC,YAAY,6JAAS,CAAC,GAAG,CAAC,KAAK,MAAM,OAAO;YAC5C,kFAAkF;YAClF,6DAA6D;YAC7D,UAAU,oLAAyB,CAAC,KAAK,MAAM,IAAI,GAAG,KAAK;YAC3D,sBAAsB;YACtB,kIAAkI;YAClI,eAAe,oLAAyB,CAAC,KAAK,MAAM,IAAI,GAAG,KAAK;YAChE,2BAA2B;YAC3B,uIAAuI;YACvI,qEAAqE;YACrE,cAAc,oLAAyB,CAAC,KAAK,MAAM,IAAI,GAAG;YAC1D,yEAAyE;YACzE,SAAS,IAAI,kKAAc,CAAC,IAAI,GAAG,CAAC,KAAK,MAAM;QACnD;IACJ;AACJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 621, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/id3v2/FrameParser.js"],"sourcesContent":["import initDebug from 'debug';\nimport * as Token from 'token-types';\nimport * as util from '../common/Util.js';\nimport { AttachedPictureType, SyncTextHeader, TextEncodingToken, TextHeader } from './ID3v2Token.js';\nimport { Genres } from '../id3v1/ID3v1Parser.js';\nimport { makeUnexpectedFileContentError } from '../ParseError.js';\nimport { decodeUintBE } from '../common/Util.js';\nconst debug = initDebug('music-metadata:id3v2:frame-parser');\nconst defaultEnc = 'latin1'; // latin1 == iso-8859-1;\nexport function parseGenre(origVal) {\n    // match everything inside parentheses\n    const genres = [];\n    let code;\n    let word = '';\n    for (const c of origVal) {\n        if (typeof code === 'string') {\n            if (c === '(' && code === '') {\n                word += '(';\n                code = undefined;\n            }\n            else if (c === ')') {\n                if (word !== '') {\n                    genres.push(word);\n                    word = '';\n                }\n                const genre = parseGenreCode(code);\n                if (genre) {\n                    genres.push(genre);\n                }\n                code = undefined;\n            }\n            else\n                code += c;\n        }\n        else if (c === '(') {\n            code = '';\n        }\n        else {\n            word += c;\n        }\n    }\n    if (word) {\n        if (genres.length === 0 && word.match(/^\\d*$/)) {\n            word = parseGenreCode(word);\n        }\n        if (word) {\n            genres.push(word);\n        }\n    }\n    return genres;\n}\nfunction parseGenreCode(code) {\n    if (code === 'RX')\n        return 'Remix';\n    if (code === 'CR')\n        return 'Cover';\n    if (code.match(/^\\d*$/)) {\n        return Genres[Number.parseInt(code, 10)];\n    }\n}\nexport class FrameParser {\n    /**\n     * Create id3v2 frame parser\n     * @param major - Major version, e.g. (4) for  id3v2.4\n     * @param warningCollector - Used to collect decode issue\n     */\n    constructor(major, warningCollector) {\n        this.major = major;\n        this.warningCollector = warningCollector;\n    }\n    readData(uint8Array, type, includeCovers) {\n        if (uint8Array.length === 0) {\n            this.warningCollector.addWarning(`id3v2.${this.major} header has empty tag type=${type}`);\n            return;\n        }\n        const { encoding, bom } = TextEncodingToken.get(uint8Array, 0);\n        const length = uint8Array.length;\n        let offset = 0;\n        let output = []; // ToDo\n        const nullTerminatorLength = FrameParser.getNullTerminatorLength(encoding);\n        let fzero;\n        debug(`Parsing tag type=${type}, encoding=${encoding}, bom=${bom}`);\n        switch (type !== 'TXXX' && type[0] === 'T' ? 'T*' : type) {\n            case 'T*': // 4.2.1. Text information frames - details\n            case 'GRP1': // iTunes-specific ID3v2 grouping field\n            case 'IPLS': // v2.3: Involved people list\n            case 'MVIN':\n            case 'MVNM':\n            case 'PCS':\n            case 'PCST': {\n                let text;\n                try {\n                    text = util.decodeString(uint8Array.subarray(1), encoding).replace(/\\x00+$/, '');\n                }\n                catch (error) {\n                    if (error instanceof Error) {\n                        this.warningCollector.addWarning(`id3v2.${this.major} type=${type} header has invalid string value: ${error.message}`);\n                        break;\n                    }\n                    throw error;\n                }\n                switch (type) {\n                    case 'TMCL': // Musician credits list\n                    case 'TIPL': // Involved people list\n                    case 'IPLS': // Involved people list\n                        output = FrameParser.functionList(this.splitValue(type, text));\n                        break;\n                    case 'TRK':\n                    case 'TRCK':\n                    case 'TPOS':\n                        output = text;\n                        break;\n                    case 'TCOM':\n                    case 'TEXT':\n                    case 'TOLY':\n                    case 'TOPE':\n                    case 'TPE1':\n                    case 'TSRC':\n                        // id3v2.3 defines that TCOM, TEXT, TOLY, TOPE & TPE1 values are separated by /\n                        output = this.splitValue(type, text);\n                        break;\n                    case 'TCO':\n                    case 'TCON':\n                        output = this.splitValue(type, text).map(v => parseGenre(v)).reduce((acc, val) => acc.concat(val), []);\n                        break;\n                    case 'PCS':\n                    case 'PCST':\n                        // TODO: Why `default` not results `1` but `''`?\n                        output = this.major >= 4 ? this.splitValue(type, text) : [text];\n                        output = (Array.isArray(output) && output[0] === '') ? 1 : 0;\n                        break;\n                    default:\n                        output = this.major >= 4 ? this.splitValue(type, text) : [text];\n                }\n                break;\n            }\n            case 'TXXX': {\n                const idAndData = FrameParser.readIdentifierAndData(uint8Array, offset + 1, length, encoding);\n                const textTag = {\n                    description: idAndData.id,\n                    text: this.splitValue(type, util.decodeString(idAndData.data, encoding).replace(/\\x00+$/, ''))\n                };\n                output = textTag;\n                break;\n            }\n            case 'PIC':\n            case 'APIC':\n                if (includeCovers) {\n                    const pic = {};\n                    offset += 1;\n                    switch (this.major) {\n                        case 2:\n                            pic.format = util.decodeString(uint8Array.subarray(offset, offset + 3), 'latin1'); // 'latin1'; // latin1 == iso-8859-1;\n                            offset += 3;\n                            break;\n                        case 3:\n                        case 4:\n                            fzero = util.findZero(uint8Array, offset, length, defaultEnc);\n                            pic.format = util.decodeString(uint8Array.subarray(offset, fzero), defaultEnc);\n                            offset = fzero + 1;\n                            break;\n                        default:\n                            throw makeUnexpectedMajorVersionError(this.major);\n                    }\n                    pic.format = FrameParser.fixPictureMimeType(pic.format);\n                    pic.type = AttachedPictureType[uint8Array[offset]];\n                    offset += 1;\n                    fzero = util.findZero(uint8Array, offset, length, encoding);\n                    pic.description = util.decodeString(uint8Array.subarray(offset, fzero), encoding);\n                    offset = fzero + nullTerminatorLength;\n                    pic.data = uint8Array.subarray(offset, length);\n                    output = pic;\n                }\n                break;\n            case 'CNT':\n            case 'PCNT':\n                output = decodeUintBE(uint8Array);\n                break;\n            case 'SYLT': {\n                const syltHeader = SyncTextHeader.get(uint8Array, 0);\n                offset += SyncTextHeader.len;\n                const result = {\n                    descriptor: '',\n                    language: syltHeader.language,\n                    contentType: syltHeader.contentType,\n                    timeStampFormat: syltHeader.timeStampFormat,\n                    syncText: []\n                };\n                let readSyllables = false;\n                while (offset < length) {\n                    const nullStr = FrameParser.readNullTerminatedString(uint8Array.subarray(offset), syltHeader.encoding);\n                    offset += nullStr.len;\n                    if (readSyllables) {\n                        const timestamp = Token.UINT32_BE.get(uint8Array, offset);\n                        offset += Token.UINT32_BE.len;\n                        result.syncText.push({\n                            text: nullStr.text,\n                            timestamp\n                        });\n                    }\n                    else {\n                        result.descriptor = nullStr.text;\n                        readSyllables = true;\n                    }\n                }\n                output = result;\n                break;\n            }\n            case 'ULT':\n            case 'USLT':\n            case 'COM':\n            case 'COMM': {\n                const textHeader = TextHeader.get(uint8Array, offset);\n                offset += TextHeader.len;\n                const descriptorStr = FrameParser.readNullTerminatedString(uint8Array.subarray(offset), textHeader.encoding);\n                offset += descriptorStr.len;\n                const textStr = FrameParser.readNullTerminatedString(uint8Array.subarray(offset), textHeader.encoding);\n                const comment = {\n                    language: textHeader.language,\n                    descriptor: descriptorStr.text,\n                    text: textStr.text\n                };\n                output = comment;\n                break;\n            }\n            case 'UFID': {\n                const ufid = FrameParser.readIdentifierAndData(uint8Array, offset, length, defaultEnc);\n                output = { owner_identifier: ufid.id, identifier: ufid.data };\n                break;\n            }\n            case 'PRIV': { // private frame\n                const priv = FrameParser.readIdentifierAndData(uint8Array, offset, length, defaultEnc);\n                output = { owner_identifier: priv.id, data: priv.data };\n                break;\n            }\n            case 'POPM': { // Popularimeter\n                fzero = util.findZero(uint8Array, offset, length, defaultEnc);\n                const email = util.decodeString(uint8Array.subarray(offset, fzero), defaultEnc);\n                offset = fzero + 1;\n                const valueLen = length - offset - 1;\n                output = {\n                    email,\n                    rating: Token.UINT8.get(uint8Array, offset),\n                    counter: valueLen > 0 ? util.decodeUintBE(uint8Array.subarray(offset + 1)) : undefined\n                };\n                break;\n            }\n            case 'GEOB': { // General encapsulated object\n                fzero = util.findZero(uint8Array, offset + 1, length, encoding);\n                const mimeType = util.decodeString(uint8Array.subarray(offset + 1, fzero), defaultEnc);\n                offset = fzero + 1;\n                fzero = util.findZero(uint8Array, offset, length, encoding);\n                const filename = util.decodeString(uint8Array.subarray(offset, fzero), defaultEnc);\n                offset = fzero + 1;\n                fzero = util.findZero(uint8Array, offset, length, encoding);\n                const description = util.decodeString(uint8Array.subarray(offset, fzero), defaultEnc);\n                offset = fzero + 1;\n                const geob = {\n                    type: mimeType,\n                    filename,\n                    description,\n                    data: uint8Array.subarray(offset, length)\n                };\n                output = geob;\n                break;\n            }\n            // W-Frames:\n            case 'WCOM':\n            case 'WCOP':\n            case 'WOAF':\n            case 'WOAR':\n            case 'WOAS':\n            case 'WORS':\n            case 'WPAY':\n            case 'WPUB':\n                // Decode URL\n                fzero = util.findZero(uint8Array, offset + 1, length, encoding);\n                output = util.decodeString(uint8Array.subarray(offset, fzero), defaultEnc);\n                break;\n            case 'WXXX': {\n                // Decode URL\n                fzero = util.findZero(uint8Array, offset + 1, length, encoding);\n                const description = util.decodeString(uint8Array.subarray(offset + 1, fzero), encoding);\n                offset = fzero + (encoding === 'utf-16le' ? 2 : 1);\n                output = { description, url: util.decodeString(uint8Array.subarray(offset, length), defaultEnc) };\n                break;\n            }\n            case 'WFD':\n            case 'WFED':\n                output = util.decodeString(uint8Array.subarray(offset + 1, util.findZero(uint8Array, offset + 1, length, encoding)), encoding);\n                break;\n            case 'MCDI': {\n                // Music CD identifier\n                output = uint8Array.subarray(0, length);\n                break;\n            }\n            default:\n                debug(`Warning: unsupported id3v2-tag-type: ${type}`);\n                break;\n        }\n        return output;\n    }\n    static readNullTerminatedString(uint8Array, encoding) {\n        let offset = encoding.bom ? 2 : 0;\n        const zeroIndex = util.findZero(uint8Array, offset, uint8Array.length, encoding.encoding);\n        const txt = uint8Array.subarray(offset, zeroIndex);\n        if (encoding.encoding === 'utf-16le') {\n            offset = zeroIndex + 2;\n        }\n        else {\n            offset = zeroIndex + 1;\n        }\n        return {\n            text: util.decodeString(txt, encoding.encoding),\n            len: offset\n        };\n    }\n    static fixPictureMimeType(pictureType) {\n        pictureType = pictureType.toLocaleLowerCase();\n        switch (pictureType) {\n            case 'jpg':\n                return 'image/jpeg';\n            case 'png':\n                return 'image/png';\n        }\n        return pictureType;\n    }\n    /**\n     * Converts TMCL (Musician credits list) or TIPL (Involved people list)\n     * @param entries\n     */\n    static functionList(entries) {\n        const res = {};\n        for (let i = 0; i + 1 < entries.length; i += 2) {\n            const names = entries[i + 1].split(',');\n            res[entries[i]] = res[entries[i]] ? res[entries[i]].concat(names) : names;\n        }\n        return res;\n    }\n    /**\n     * id3v2.4 defines that multiple T* values are separated by 0x00\n     * id3v2.3 defines that TCOM, TEXT, TOLY, TOPE & TPE1 values are separated by /\n     * @param tag - Tag name\n     * @param text - Concatenated tag value\n     * @returns Split tag value\n     */\n    splitValue(tag, text) {\n        let values;\n        if (this.major < 4) {\n            values = text.split(/\\x00/g);\n            if (values.length > 1) {\n                this.warningCollector.addWarning(`ID3v2.${this.major} ${tag} uses non standard null-separator.`);\n            }\n            else {\n                values = text.split(/\\//g);\n            }\n        }\n        else {\n            values = text.split(/\\x00/g);\n        }\n        return FrameParser.trimArray(values);\n    }\n    static trimArray(values) {\n        return values.map(value => value.replace(/\\x00+$/, '').trim());\n    }\n    static readIdentifierAndData(uint8Array, offset, length, encoding) {\n        const fzero = util.findZero(uint8Array, offset, length, encoding);\n        const id = util.decodeString(uint8Array.subarray(offset, fzero), encoding);\n        offset = fzero + FrameParser.getNullTerminatorLength(encoding);\n        return { id, data: uint8Array.subarray(offset, length) };\n    }\n    static getNullTerminatorLength(enc) {\n        return enc === 'utf-16le' ? 2 : 1;\n    }\n}\nexport class Id3v2ContentError extends makeUnexpectedFileContentError('id3v2') {\n}\nfunction makeUnexpectedMajorVersionError(majorVer) {\n    throw new Id3v2ContentError(`Unexpected majorVer: ${majorVer}`);\n}\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1030, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/id3v2/ID3v2Parser.js"],"sourcesContent":["import * as Token from 'token-types';\nimport * as util from '../common/Util.js';\nimport { FrameParser, Id3v2ContentError } from './FrameParser.js';\nimport { ExtendedHeader, ID3v2Header, UINT32SYNCSAFE } from './ID3v2Token.js';\nimport { textDecode } from '@borewit/text-codec';\nexport class ID3v2Parser {\n    constructor() {\n        this.tokenizer = undefined;\n        this.id3Header = undefined;\n        this.metadata = undefined;\n        this.headerType = undefined;\n        this.options = undefined;\n    }\n    static removeUnsyncBytes(buffer) {\n        let readI = 0;\n        let writeI = 0;\n        while (readI < buffer.length - 1) {\n            if (readI !== writeI) {\n                buffer[writeI] = buffer[readI];\n            }\n            readI += (buffer[readI] === 0xFF && buffer[readI + 1] === 0) ? 2 : 1;\n            writeI++;\n        }\n        if (readI < buffer.length) {\n            buffer[writeI++] = buffer[readI];\n        }\n        return buffer.subarray(0, writeI);\n    }\n    static getFrameHeaderLength(majorVer) {\n        switch (majorVer) {\n            case 2:\n                return 6;\n            case 3:\n            case 4:\n                return 10;\n            default:\n                throw makeUnexpectedMajorVersionError(majorVer);\n        }\n    }\n    static readFrameFlags(b) {\n        return {\n            status: {\n                tag_alter_preservation: util.getBit(b, 0, 6),\n                file_alter_preservation: util.getBit(b, 0, 5),\n                read_only: util.getBit(b, 0, 4)\n            },\n            format: {\n                grouping_identity: util.getBit(b, 1, 7),\n                compression: util.getBit(b, 1, 3),\n                encryption: util.getBit(b, 1, 2),\n                unsynchronisation: util.getBit(b, 1, 1),\n                data_length_indicator: util.getBit(b, 1, 0)\n            }\n        };\n    }\n    static readFrameData(uint8Array, frameHeader, majorVer, includeCovers, warningCollector) {\n        const frameParser = new FrameParser(majorVer, warningCollector);\n        switch (majorVer) {\n            case 2:\n                return frameParser.readData(uint8Array, frameHeader.id, includeCovers);\n            case 3:\n            case 4:\n                if (frameHeader.flags?.format.unsynchronisation) {\n                    uint8Array = ID3v2Parser.removeUnsyncBytes(uint8Array);\n                }\n                if (frameHeader.flags?.format.data_length_indicator) {\n                    uint8Array = uint8Array.subarray(4, uint8Array.length);\n                }\n                return frameParser.readData(uint8Array, frameHeader.id, includeCovers);\n            default:\n                throw makeUnexpectedMajorVersionError(majorVer);\n        }\n    }\n    /**\n     * Create a combined tag key, of tag & description\n     * @param tag e.g.: COM\n     * @param description e.g. iTunPGAP\n     * @returns string e.g. COM:iTunPGAP\n     */\n    static makeDescriptionTagName(tag, description) {\n        return tag + (description ? `:${description}` : '');\n    }\n    async parse(metadata, tokenizer, options) {\n        this.tokenizer = tokenizer;\n        this.metadata = metadata;\n        this.options = options;\n        const id3Header = await this.tokenizer.readToken(ID3v2Header);\n        if (id3Header.fileIdentifier !== 'ID3') {\n            throw new Id3v2ContentError('expected ID3-header file-identifier \\'ID3\\' was not found');\n        }\n        this.id3Header = id3Header;\n        this.headerType = (`ID3v2.${id3Header.version.major}`);\n        return id3Header.flags.isExtendedHeader ? this.parseExtendedHeader() : this.parseId3Data(id3Header.size);\n    }\n    async parseExtendedHeader() {\n        const extendedHeader = await this.tokenizer.readToken(ExtendedHeader);\n        const dataRemaining = extendedHeader.size - ExtendedHeader.len;\n        return dataRemaining > 0 ? this.parseExtendedHeaderData(dataRemaining, extendedHeader.size) : this.parseId3Data(this.id3Header.size - extendedHeader.size);\n    }\n    async parseExtendedHeaderData(dataRemaining, extendedHeaderSize) {\n        await this.tokenizer.ignore(dataRemaining);\n        return this.parseId3Data(this.id3Header.size - extendedHeaderSize);\n    }\n    async parseId3Data(dataLen) {\n        const uint8Array = await this.tokenizer.readToken(new Token.Uint8ArrayType(dataLen));\n        for (const tag of this.parseMetadata(uint8Array)) {\n            switch (tag.id) {\n                case 'TXXX':\n                    if (tag.value) {\n                        await this.handleTag(tag, tag.value.text, () => tag.value.description);\n                    }\n                    break;\n                default:\n                    await (Array.isArray(tag.value) ? Promise.all(tag.value.map(value => this.addTag(tag.id, value))) : this.addTag(tag.id, tag.value));\n            }\n        }\n    }\n    async handleTag(tag, values, descriptor, resolveValue = value => value) {\n        await Promise.all(values.map(value => this.addTag(ID3v2Parser.makeDescriptionTagName(tag.id, descriptor(value)), resolveValue(value))));\n    }\n    async addTag(id, value) {\n        await this.metadata.addTag(this.headerType, id, value);\n    }\n    parseMetadata(data) {\n        let offset = 0;\n        const tags = [];\n        while (true) {\n            if (offset === data.length)\n                break;\n            const frameHeaderLength = ID3v2Parser.getFrameHeaderLength(this.id3Header.version.major);\n            if (offset + frameHeaderLength > data.length) {\n                this.metadata.addWarning('Illegal ID3v2 tag length');\n                break;\n            }\n            const frameHeaderBytes = data.subarray(offset, offset + frameHeaderLength);\n            offset += frameHeaderLength;\n            const frameHeader = this.readFrameHeader(frameHeaderBytes, this.id3Header.version.major);\n            const frameDataBytes = data.subarray(offset, offset + frameHeader.length);\n            offset += frameHeader.length;\n            const values = ID3v2Parser.readFrameData(frameDataBytes, frameHeader, this.id3Header.version.major, !this.options.skipCovers, this.metadata);\n            if (values) {\n                tags.push({ id: frameHeader.id, value: values });\n            }\n        }\n        return tags;\n    }\n    readFrameHeader(uint8Array, majorVer) {\n        let header;\n        switch (majorVer) {\n            case 2:\n                header = {\n                    id: textDecode(uint8Array.subarray(0, 3), 'ascii'),\n                    length: Token.UINT24_BE.get(uint8Array, 3)\n                };\n                if (!header.id.match(/[A-Z0-9]{3}/g)) {\n                    this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${header.id}`);\n                }\n                break;\n            case 3:\n            case 4:\n                header = {\n                    id: textDecode(uint8Array.subarray(0, 4), 'ascii'),\n                    length: (majorVer === 4 ? UINT32SYNCSAFE : Token.UINT32_BE).get(uint8Array, 4),\n                    flags: ID3v2Parser.readFrameFlags(uint8Array.subarray(8, 10))\n                };\n                if (!header.id.match(/[A-Z0-9]{4}/g)) {\n                    this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${header.id}`);\n                }\n                break;\n            default:\n                throw makeUnexpectedMajorVersionError(majorVer);\n        }\n        return header;\n    }\n}\nfunction makeUnexpectedMajorVersionError(majorVer) {\n    throw new Id3v2ContentError(`Unexpected majorVer: ${majorVer}`);\n}\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1222, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/id3v2/AbstractID3Parser.js"],"sourcesContent":["import { EndOfStreamError } from 'strtok3';\nimport initDebug from 'debug';\nimport { ID3v2Header } from './ID3v2Token.js';\nimport { ID3v2Parser } from './ID3v2Parser.js';\nimport { ID3v1Parser } from '../id3v1/ID3v1Parser.js';\nimport { BasicParser } from '../common/BasicParser.js';\nconst debug = initDebug('music-metadata:parser:ID3');\n/**\n * Abstract parser which tries take ID3v2 and ID3v1 headers.\n */\nexport class AbstractID3Parser extends BasicParser {\n    constructor() {\n        super(...arguments);\n        this.id3parser = new ID3v2Parser();\n    }\n    static async startsWithID3v2Header(tokenizer) {\n        return (await tokenizer.peekToken(ID3v2Header)).fileIdentifier === 'ID3';\n    }\n    async parse() {\n        try {\n            await this.parseID3v2();\n        }\n        catch (err) {\n            if (err instanceof EndOfStreamError) {\n                debug(\"End-of-stream\");\n            }\n            else {\n                throw err;\n            }\n        }\n    }\n    finalize() {\n        return;\n    }\n    async parseID3v2() {\n        await this.tryReadId3v2Headers();\n        debug('End of ID3v2 header, go to MPEG-parser: pos=%s', this.tokenizer.position);\n        await this.postId3v2Parse();\n        if (this.options.skipPostHeaders && this.metadata.hasAny()) {\n            this.finalize();\n        }\n        else {\n            const id3v1parser = new ID3v1Parser(this.metadata, this.tokenizer, this.options);\n            await id3v1parser.parse();\n            this.finalize();\n        }\n    }\n    async tryReadId3v2Headers() {\n        const id3Header = await this.tokenizer.peekToken(ID3v2Header);\n        if (id3Header.fileIdentifier === 'ID3') {\n            debug('Found ID3v2 header, pos=%s', this.tokenizer.position);\n            await this.id3parser.parse(this.metadata, this.tokenizer, this.options);\n            return this.tryReadId3v2Headers();\n        }\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AACA,MAAM,QAAQ,IAAA,kJAAS,EAAC;AAIjB,MAAM,0BAA0B,kLAAW;IAC9C,aAAc;QACV,KAAK,IAAI;QACT,IAAI,CAAC,SAAS,GAAG,IAAI,iLAAW;IACpC;IACA,aAAa,sBAAsB,SAAS,EAAE;QAC1C,OAAO,CAAC,MAAM,UAAU,SAAS,CAAC,gLAAW,CAAC,EAAE,cAAc,KAAK;IACvE;IACA,MAAM,QAAQ;QACV,IAAI;YACA,MAAM,IAAI,CAAC,UAAU;QACzB,EACA,OAAO,KAAK;YACR,IAAI,eAAe,4JAAgB,EAAE;gBACjC,MAAM;YACV,OACK;gBACD,MAAM;YACV;QACJ;IACJ;IACA,WAAW;QACP;IACJ;IACA,MAAM,aAAa;QACf,MAAM,IAAI,CAAC,mBAAmB;QAC9B,MAAM,kDAAkD,IAAI,CAAC,SAAS,CAAC,QAAQ;QAC/E,MAAM,IAAI,CAAC,cAAc;QACzB,IAAI,IAAI,CAAC,OAAO,CAAC,eAAe,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,IAAI;YACxD,IAAI,CAAC,QAAQ;QACjB,OACK;YACD,MAAM,cAAc,IAAI,iLAAW,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO;YAC/E,MAAM,YAAY,KAAK;YACvB,IAAI,CAAC,QAAQ;QACjB;IACJ;IACA,MAAM,sBAAsB;QACxB,MAAM,YAAY,MAAM,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,gLAAW;QAC5D,IAAI,UAAU,cAAc,KAAK,OAAO;YACpC,MAAM,8BAA8B,IAAI,CAAC,SAAS,CAAC,QAAQ;YAC3D,MAAM,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO;YACtE,OAAO,IAAI,CAAC,mBAAmB;QACnC;IACJ;AACJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1287, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/flac/FlacParser.js"],"sourcesContent":["import initDebug from 'debug';\nimport { Uint8ArrayType } from 'token-types';\nimport { VorbisPictureToken } from '../ogg/vorbis/Vorbis.js';\nimport { AbstractID3Parser } from '../id3v2/AbstractID3Parser.js';\nimport { FourCcToken } from '../common/FourCC.js';\nimport { VorbisStream } from '../ogg/vorbis/VorbisStream.js';\nimport { VorbisDecoder } from '../ogg/vorbis/VorbisDecoder.js';\nimport { makeUnexpectedFileContentError } from '../ParseError.js';\nimport * as Flac from './FlacToken.js';\nconst debug = initDebug('music-metadata:parser:FLAC');\nclass FlacContentError extends makeUnexpectedFileContentError('FLAC') {\n}\nexport class FlacParser extends AbstractID3Parser {\n    constructor() {\n        super(...arguments);\n        this.vorbisParser = new VorbisStream(this.metadata, this.options);\n        this.padding = 0;\n    }\n    async postId3v2Parse() {\n        const fourCC = await this.tokenizer.readToken(FourCcToken);\n        if (fourCC.toString() !== 'fLaC') {\n            throw new FlacContentError('Invalid FLAC preamble');\n        }\n        let blockHeader;\n        do {\n            // Read block header\n            blockHeader = await this.tokenizer.readToken(Flac.BlockHeader);\n            // Parse block data\n            await this.parseDataBlock(blockHeader);\n        } while (!blockHeader.lastBlock);\n        if (this.tokenizer.fileInfo.size && this.metadata.format.duration) {\n            const dataSize = this.tokenizer.fileInfo.size - this.tokenizer.position;\n            this.metadata.setFormat('bitrate', 8 * dataSize / this.metadata.format.duration);\n        }\n    }\n    async parseDataBlock(blockHeader) {\n        debug(`blockHeader type=${blockHeader.type}, length=${blockHeader.length}`);\n        switch (blockHeader.type) {\n            case Flac.BlockType.STREAMINFO:\n                return this.readBlockStreamInfo(blockHeader.length);\n            case Flac.BlockType.PADDING:\n                this.padding += blockHeader.length;\n                break;\n            case Flac.BlockType.APPLICATION:\n                break;\n            case Flac.BlockType.SEEKTABLE:\n                break;\n            case Flac.BlockType.VORBIS_COMMENT:\n                return this.readComment(blockHeader.length);\n            case Flac.BlockType.CUESHEET:\n                break;\n            case Flac.BlockType.PICTURE:\n                await this.parsePicture(blockHeader.length);\n                return;\n            default:\n                this.metadata.addWarning(`Unknown block type: ${blockHeader.type}`);\n        }\n        // Ignore data block\n        return this.tokenizer.ignore(blockHeader.length).then();\n    }\n    /**\n     * Parse STREAMINFO\n     */\n    async readBlockStreamInfo(dataLen) {\n        if (dataLen !== Flac.BlockStreamInfo.len)\n            throw new FlacContentError('Unexpected block-stream-info length');\n        const streamInfo = await this.tokenizer.readToken(Flac.BlockStreamInfo);\n        this.metadata.setFormat('container', 'FLAC');\n        this.processsStreamInfo(streamInfo);\n    }\n    /**\n     * Parse STREAMINFO\n     */\n    processsStreamInfo(streamInfo) {\n        this.metadata.setFormat('codec', 'FLAC');\n        this.metadata.setFormat('hasAudio', true);\n        this.metadata.setFormat('lossless', true);\n        this.metadata.setFormat('numberOfChannels', streamInfo.channels);\n        this.metadata.setFormat('bitsPerSample', streamInfo.bitsPerSample);\n        this.metadata.setFormat('sampleRate', streamInfo.sampleRate);\n        if (streamInfo.totalSamples > 0) {\n            this.metadata.setFormat('duration', streamInfo.totalSamples / streamInfo.sampleRate);\n        }\n    }\n    /**\n     * Read VORBIS_COMMENT from tokenizer\n     * Ref: https://www.xiph.org/vorbis/doc/Vorbis_I_spec.html#x1-640004.2.3\n     */\n    async readComment(dataLen) {\n        const data = await this.tokenizer.readToken(new Uint8ArrayType(dataLen));\n        return this.parseComment(data);\n    }\n    /**\n     * Parse VORBIS_COMMENT\n     * Ref: https://www.xiph.org/vorbis/doc/Vorbis_I_spec.html#x1-640004.2.3\n     */\n    async parseComment(data) {\n        const decoder = new VorbisDecoder(data, 0);\n        const vendor = decoder.readStringUtf8();\n        if (vendor.length > 0) {\n            this.metadata.setFormat('tool', vendor);\n        }\n        const commentListLength = decoder.readInt32();\n        const tags = new Array(commentListLength);\n        for (let i = 0; i < commentListLength; i++) {\n            tags[i] = decoder.parseUserComment();\n        }\n        await Promise.all(tags.map(tag => {\n            if (tag.key === 'ENCODER') {\n                this.metadata.setFormat('tool', tag.value);\n            }\n            return this.addTag(tag.key, tag.value);\n        }));\n    }\n    async parsePicture(dataLen) {\n        if (this.options.skipCovers) {\n            return this.tokenizer.ignore(dataLen);\n        }\n        return this.addPictureTag(await this.tokenizer.readToken(new VorbisPictureToken(dataLen)));\n    }\n    addPictureTag(picture) {\n        return this.addTag('METADATA_BLOCK_PICTURE', picture);\n    }\n    addTag(id, value) {\n        return this.vorbisParser.addTag(id, value);\n    }\n}\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1426, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/ogg/flac/FlacStream.js"],"sourcesContent":["import initDebug from 'debug';\nimport * as Flac from '../../flac/FlacToken.js';\nimport { FlacParser } from '../../flac/FlacParser.js';\nimport { FourCcToken } from '../../common/FourCC.js';\nimport { VorbisPictureToken } from '../vorbis/Vorbis.js';\nconst debug = initDebug('music-metadata:parser:ogg:theora');\n/**\n * Ref:\n * - https://xiph.org/flac/ogg_mapping.html\n */\nexport class FlacStream {\n    constructor(metadata, options, tokenizer) {\n        this.durationOnLastPage = false;\n        this.metadata = metadata;\n        this.options = options;\n        this.tokenizer = tokenizer;\n        this.flacParser = new FlacParser(this.metadata, this.tokenizer, options);\n    }\n    /**\n     * Vorbis 1 parser\n     * @param header Ogg Page Header\n     * @param pageData Page data\n     */\n    async parsePage(header, pageData) {\n        if (header.headerType.firstPage) {\n            await this.parseFirstPage(header, pageData);\n        }\n    }\n    calculateDuration() {\n        debug('duration calculation not implemented');\n    }\n    /**\n     * Parse first Theora Ogg page. the initial identification header packet\n     */\n    async parseFirstPage(_header, pageData) {\n        debug('First Ogg/FLAC page');\n        const fourCC = await FourCcToken.get(pageData, 9);\n        if (fourCC.toString() !== 'fLaC') {\n            throw new Error('Invalid FLAC preamble');\n        }\n        const blockHeader = await Flac.BlockHeader.get(pageData, 13);\n        await this.parseDataBlock(blockHeader, pageData.subarray(13 + Flac.BlockHeader.len));\n    }\n    async parseDataBlock(blockHeader, pageData) {\n        debug(`blockHeader type=${blockHeader.type}, length=${blockHeader.length}`);\n        switch (blockHeader.type) {\n            case Flac.BlockType.STREAMINFO: {\n                const streamInfo = Flac.BlockStreamInfo.get(pageData, 0);\n                return this.flacParser.processsStreamInfo(streamInfo);\n            }\n            case Flac.BlockType.PADDING:\n                break;\n            case Flac.BlockType.APPLICATION:\n                break;\n            case Flac.BlockType.SEEKTABLE:\n                break;\n            case Flac.BlockType.VORBIS_COMMENT:\n                return this.flacParser.parseComment(pageData);\n            case Flac.BlockType.PICTURE:\n                if (!this.options.skipCovers) {\n                    const picture = new VorbisPictureToken(pageData.length).get(pageData, 0);\n                    return this.flacParser.addPictureTag(picture);\n                }\n                break;\n            default:\n                this.metadata.addWarning(`Unknown block type: ${blockHeader.type}`);\n        }\n        // Ignore data block\n        return this.tokenizer.ignore(blockHeader.length).then();\n    }\n    flush() {\n        return Promise.resolve();\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AACA,MAAM,QAAQ,IAAA,kJAAS,EAAC;AAKjB,MAAM;IACT,YAAY,QAAQ,EAAE,OAAO,EAAE,SAAS,CAAE;QACtC,IAAI,CAAC,kBAAkB,GAAG;QAC1B,IAAI,CAAC,QAAQ,GAAG;QAChB,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,CAAC,UAAU,GAAG,IAAI,8KAAU,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,EAAE;IACpE;IACA;;;;KAIC,GACD,MAAM,UAAU,MAAM,EAAE,QAAQ,EAAE;QAC9B,IAAI,OAAO,UAAU,CAAC,SAAS,EAAE;YAC7B,MAAM,IAAI,CAAC,cAAc,CAAC,QAAQ;QACtC;IACJ;IACA,oBAAoB;QAChB,MAAM;IACV;IACA;;KAEC,GACD,MAAM,eAAe,OAAO,EAAE,QAAQ,EAAE;QACpC,MAAM;QACN,MAAM,SAAS,MAAM,6KAAW,CAAC,GAAG,CAAC,UAAU;QAC/C,IAAI,OAAO,QAAQ,OAAO,QAAQ;YAC9B,MAAM,IAAI,MAAM;QACpB;QACA,MAAM,cAAc,MAAM,8KAAgB,CAAC,GAAG,CAAC,UAAU;QACzD,MAAM,IAAI,CAAC,cAAc,CAAC,aAAa,SAAS,QAAQ,CAAC,KAAK,8KAAgB,CAAC,GAAG;IACtF;IACA,MAAM,eAAe,WAAW,EAAE,QAAQ,EAAE;QACxC,MAAM,CAAC,iBAAiB,EAAE,YAAY,IAAI,CAAC,SAAS,EAAE,YAAY,MAAM,EAAE;QAC1E,OAAQ,YAAY,IAAI;YACpB,KAAK,4KAAc,CAAC,UAAU;gBAAE;oBAC5B,MAAM,aAAa,kLAAoB,CAAC,GAAG,CAAC,UAAU;oBACtD,OAAO,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAC;gBAC9C;YACA,KAAK,4KAAc,CAAC,OAAO;gBACvB;YACJ,KAAK,4KAAc,CAAC,WAAW;gBAC3B;YACJ,KAAK,4KAAc,CAAC,SAAS;gBACzB;YACJ,KAAK,4KAAc,CAAC,cAAc;gBAC9B,OAAO,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC;YACxC,KAAK,4KAAc,CAAC,OAAO;gBACvB,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE;oBAC1B,MAAM,UAAU,IAAI,2LAAkB,CAAC,SAAS,MAAM,EAAE,GAAG,CAAC,UAAU;oBACtE,OAAO,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC;gBACzC;gBACA;YACJ;gBACI,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,oBAAoB,EAAE,YAAY,IAAI,EAAE;QAC1E;QACA,oBAAoB;QACpB,OAAO,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,YAAY,MAAM,EAAE,IAAI;IACzD;IACA,QAAQ;QACJ,OAAO,QAAQ,OAAO;IAC1B;AACJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1508, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Szymon/Desktop/bezpiesniowy/node_modules/music-metadata/lib/ogg/OggParser.js"],"sourcesContent":["import * as Token from 'token-types';\nimport { EndOfStreamError } from 'strtok3';\nimport initDebug from 'debug';\nimport { BasicParser } from '../common/BasicParser.js';\nimport { VorbisStream } from './vorbis/VorbisStream.js';\nimport { OpusStream } from './opus/OpusStream.js';\nimport { SpeexStream } from './speex/SpeexStream.js';\nimport { TheoraStream } from './theora/TheoraStream.js';\nimport { makeUnexpectedFileContentError } from '../ParseError.js';\nimport { PageHeader, SegmentTable } from './OggToken.js';\nimport { FlacStream } from './flac/FlacStream.js';\nexport class OggContentError extends makeUnexpectedFileContentError('Ogg') {\n}\nconst debug = initDebug('music-metadata:parser:ogg');\nclass OggStream {\n    constructor(metadata, streamSerial, options) {\n        this.pageNumber = 0;\n        this.closed = false;\n        this.metadata = metadata;\n        this.streamSerial = streamSerial;\n        this.options = options;\n    }\n    async parsePage(tokenizer, header) {\n        this.pageNumber = header.pageSequenceNo;\n        debug('serial=%s page#=%s, Ogg.id=%s', header.streamSerialNumber, header.pageSequenceNo, header.capturePattern);\n        const segmentTable = await tokenizer.readToken(new SegmentTable(header));\n        debug('totalPageSize=%s', segmentTable.totalPageSize);\n        const pageData = await tokenizer.readToken(new Token.Uint8ArrayType(segmentTable.totalPageSize));\n        debug('firstPage=%s, lastPage=%s, continued=%s', header.headerType.firstPage, header.headerType.lastPage, header.headerType.continued);\n        if (header.headerType.firstPage) {\n            this.metadata.setFormat('container', 'Ogg');\n            const idData = pageData.subarray(0, 7); // Copy this portion\n            const asciiId = Array.from(idData)\n                .filter(b => b >= 32 && b <= 126) // Keep only printable ASCII\n                .map(b => String.fromCharCode(b))\n                .join('');\n            switch (asciiId) {\n                case 'vorbis': // Ogg/Vorbis\n                    debug(`Set Ogg stream serial ${header.streamSerialNumber}, codec=Vorbis`);\n                    this.pageConsumer = new VorbisStream(this.metadata, this.options);\n                    break;\n                case 'OpusHea': // Ogg/Opus\n                    debug('Set page consumer to Ogg/Opus');\n                    this.pageConsumer = new OpusStream(this.metadata, this.options, tokenizer);\n                    break;\n                case 'Speex  ': // Ogg/Speex\n                    debug('Set page consumer to Ogg/Speex');\n                    this.pageConsumer = new SpeexStream(this.metadata, this.options, tokenizer);\n                    break;\n                case 'fishead':\n                case 'theora': // Ogg/Theora\n                    debug('Set page consumer to Ogg/Theora');\n                    this.pageConsumer = new TheoraStream(this.metadata, this.options, tokenizer);\n                    break;\n                case 'FLAC': // Ogg/Theora\n                    debug('Set page consumer to Vorbis');\n                    this.pageConsumer = new FlacStream(this.metadata, this.options, tokenizer);\n                    break;\n                default:\n                    throw new OggContentError(`Ogg codec not recognized (id=${asciiId}`);\n            }\n        }\n        if (header.headerType.lastPage) {\n            this.closed = true;\n        }\n        if (this.pageConsumer) {\n            await this.pageConsumer.parsePage(header, pageData);\n        }\n        else\n            throw new Error('pageConsumer should be initialized');\n    }\n}\n/**\n * Parser for Ogg logical bitstream framing\n */\nexport class OggParser extends BasicParser {\n    constructor() {\n        super(...arguments);\n        this.streams = new Map();\n    }\n    /**\n     * Parse page\n     * @returns {Promise<void>}\n     */\n    async parse() {\n        this.streams = new Map();\n        let header;\n        try {\n            do {\n                header = await this.tokenizer.readToken(PageHeader);\n                if (header.capturePattern !== 'OggS')\n                    throw new OggContentError('Invalid Ogg capture pattern');\n                let stream = this.streams.get(header.streamSerialNumber);\n                if (!stream) {\n                    stream = new OggStream(this.metadata, header.streamSerialNumber, this.options);\n                    this.streams.set(header.streamSerialNumber, stream);\n                }\n                await stream.parsePage(this.tokenizer, header);\n                if (stream.pageNumber > 12 && !(this.options.duration && [...this.streams.values()].find(stream => stream.pageConsumer?.durationOnLastPage))) {\n                    debug(\"Stop processing Ogg stream\");\n                    break;\n                }\n            } while (![...this.streams.values()].every(item => item.closed));\n        }\n        catch (err) {\n            if (err instanceof EndOfStreamError) {\n                debug(\"Reached end-of-stream\");\n            }\n            else if (err instanceof OggContentError) {\n                this.metadata.addWarning(`Corrupt Ogg content at ${this.tokenizer.position}`);\n            }\n            else\n                throw err;\n        }\n        for (const stream of this.streams.values()) {\n            if (!stream.closed) {\n                this.metadata.addWarning(`End-of-stream reached before reaching last page in Ogg stream serial=${stream.streamSerial}`);\n                await stream.pageConsumer?.flush();\n            }\n            stream.pageConsumer?.calculateDuration();\n        }\n    }\n}\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}}]
}